{"ast":null,"code":"'use strict';\n\nvar attrsKey = 'aaAttrs';\n\nvar _ = require('../common/utils.js');\n\nvar DOM = require('../common/dom.js');\n\nvar EventBus = require('./event_bus.js');\n\nvar Input = require('./input.js');\n\nvar Dropdown = require('./dropdown.js');\n\nvar html = require('./html.js');\n\nvar css = require('./css.js'); // constructor\n// -----------\n// THOUGHT: what if datasets could dynamically be added/removed?\n\n\nfunction Typeahead(o) {\n  var $menu;\n  var $hint;\n  o = o || {};\n\n  if (!o.input) {\n    _.error('missing input');\n  }\n\n  this.isActivated = false;\n  this.debug = !!o.debug;\n  this.autoselect = !!o.autoselect;\n  this.autoselectOnBlur = !!o.autoselectOnBlur;\n  this.openOnFocus = !!o.openOnFocus;\n  this.minLength = _.isNumber(o.minLength) ? o.minLength : 1;\n  this.autoWidth = o.autoWidth === undefined ? true : !!o.autoWidth;\n  this.clearOnSelected = !!o.clearOnSelected;\n  this.tabAutocomplete = o.tabAutocomplete === undefined ? true : !!o.tabAutocomplete;\n  o.hint = !!o.hint;\n\n  if (o.hint && o.appendTo) {\n    throw new Error('[autocomplete.js] hint and appendTo options can\\'t be used at the same time');\n  }\n\n  this.css = o.css = _.mixin({}, css, o.appendTo ? css.appendTo : {});\n  this.cssClasses = o.cssClasses = _.mixin({}, css.defaultClasses, o.cssClasses || {});\n  this.cssClasses.prefix = o.cssClasses.formattedPrefix = _.formatPrefix(this.cssClasses.prefix, this.cssClasses.noPrefix);\n  this.listboxId = o.listboxId = [this.cssClasses.root, 'listbox', _.getUniqueId()].join('-');\n  var domElts = buildDom(o);\n  this.$node = domElts.wrapper;\n  var $input = this.$input = domElts.input;\n  $menu = domElts.menu;\n  $hint = domElts.hint;\n\n  if (o.dropdownMenuContainer) {\n    DOM.element(o.dropdownMenuContainer).css('position', 'relative') // ensure the container has a relative position\n    .append($menu.css('top', '0')); // override the top: 100%\n  } // #705: if there's scrollable overflow, ie doesn't support\n  // blur cancellations when the scrollbar is clicked\n  //\n  // #351: preventDefault won't cancel blurs in ie <= 8\n\n\n  $input.on('blur.aa', function ($e) {\n    var active = document.activeElement;\n\n    if (_.isMsie() && ($menu[0] === active || $menu[0].contains(active))) {\n      $e.preventDefault(); // stop immediate in order to prevent Input#_onBlur from\n      // getting exectued\n\n      $e.stopImmediatePropagation();\n\n      _.defer(function () {\n        $input.focus();\n      });\n    }\n  }); // #351: prevents input blur due to clicks within dropdown menu\n\n  $menu.on('mousedown.aa', function ($e) {\n    $e.preventDefault();\n  });\n  this.eventBus = o.eventBus || new EventBus({\n    el: $input\n  });\n  this.dropdown = new Typeahead.Dropdown({\n    appendTo: o.appendTo,\n    wrapper: this.$node,\n    menu: $menu,\n    datasets: o.datasets,\n    templates: o.templates,\n    cssClasses: o.cssClasses,\n    minLength: this.minLength\n  }).onSync('suggestionClicked', this._onSuggestionClicked, this).onSync('cursorMoved', this._onCursorMoved, this).onSync('cursorRemoved', this._onCursorRemoved, this).onSync('opened', this._onOpened, this).onSync('closed', this._onClosed, this).onSync('shown', this._onShown, this).onSync('empty', this._onEmpty, this).onSync('redrawn', this._onRedrawn, this).onAsync('datasetRendered', this._onDatasetRendered, this);\n  this.input = new Typeahead.Input({\n    input: $input,\n    hint: $hint\n  }).onSync('focused', this._onFocused, this).onSync('blurred', this._onBlurred, this).onSync('enterKeyed', this._onEnterKeyed, this).onSync('tabKeyed', this._onTabKeyed, this).onSync('escKeyed', this._onEscKeyed, this).onSync('upKeyed', this._onUpKeyed, this).onSync('downKeyed', this._onDownKeyed, this).onSync('leftKeyed', this._onLeftKeyed, this).onSync('rightKeyed', this._onRightKeyed, this).onSync('queryChanged', this._onQueryChanged, this).onSync('whitespaceChanged', this._onWhitespaceChanged, this);\n\n  this._bindKeyboardShortcuts(o);\n\n  this._setLanguageDirection();\n} // instance methods\n// ----------------\n\n\n_.mixin(Typeahead.prototype, {\n  // ### private\n  _bindKeyboardShortcuts: function (options) {\n    if (!options.keyboardShortcuts) {\n      return;\n    }\n\n    var $input = this.$input;\n    var keyboardShortcuts = [];\n\n    _.each(options.keyboardShortcuts, function (key) {\n      if (typeof key === 'string') {\n        key = key.toUpperCase().charCodeAt(0);\n      }\n\n      keyboardShortcuts.push(key);\n    });\n\n    DOM.element(document).keydown(function (event) {\n      var elt = event.target || event.srcElement;\n      var tagName = elt.tagName;\n\n      if (elt.isContentEditable || tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA') {\n        // already in an input\n        return;\n      }\n\n      var which = event.which || event.keyCode;\n\n      if (keyboardShortcuts.indexOf(which) === -1) {\n        // not the right shortcut\n        return;\n      }\n\n      $input.focus();\n      event.stopPropagation();\n      event.preventDefault();\n    });\n  },\n  _onSuggestionClicked: function onSuggestionClicked(type, $el) {\n    var datum;\n    var context = {\n      selectionMethod: 'click'\n    };\n\n    if (datum = this.dropdown.getDatumForSuggestion($el)) {\n      this._select(datum, context);\n    }\n  },\n  _onCursorMoved: function onCursorMoved(event, updateInput) {\n    var datum = this.dropdown.getDatumForCursor();\n    var currentCursorId = this.dropdown.getCurrentCursor().attr('id');\n    this.input.setActiveDescendant(currentCursorId);\n\n    if (datum) {\n      if (updateInput) {\n        this.input.setInputValue(datum.value, true);\n      }\n\n      this.eventBus.trigger('cursorchanged', datum.raw, datum.datasetName);\n    }\n  },\n  _onCursorRemoved: function onCursorRemoved() {\n    this.input.resetInputValue();\n\n    this._updateHint();\n\n    this.eventBus.trigger('cursorremoved');\n  },\n  _onDatasetRendered: function onDatasetRendered() {\n    this._updateHint();\n\n    this.eventBus.trigger('updated');\n  },\n  _onOpened: function onOpened() {\n    this._updateHint();\n\n    this.input.expand();\n    this.eventBus.trigger('opened');\n  },\n  _onEmpty: function onEmpty() {\n    this.eventBus.trigger('empty');\n  },\n  _onRedrawn: function onRedrawn() {\n    this.$node.css('top', 0 + 'px');\n    this.$node.css('left', 0 + 'px');\n    var inputRect = this.$input[0].getBoundingClientRect();\n\n    if (this.autoWidth) {\n      this.$node.css('width', inputRect.width + 'px');\n    }\n\n    var wrapperRect = this.$node[0].getBoundingClientRect();\n    var top = inputRect.bottom - wrapperRect.top;\n    this.$node.css('top', top + 'px');\n    var left = inputRect.left - wrapperRect.left;\n    this.$node.css('left', left + 'px');\n    this.eventBus.trigger('redrawn');\n  },\n  _onShown: function onShown() {\n    this.eventBus.trigger('shown');\n\n    if (this.autoselect) {\n      this.dropdown.cursorTopSuggestion();\n    }\n  },\n  _onClosed: function onClosed() {\n    this.input.clearHint();\n    this.input.removeActiveDescendant();\n    this.input.collapse();\n    this.eventBus.trigger('closed');\n  },\n  _onFocused: function onFocused() {\n    this.isActivated = true;\n\n    if (this.openOnFocus) {\n      var query = this.input.getQuery();\n\n      if (query.length >= this.minLength) {\n        this.dropdown.update(query);\n      } else {\n        this.dropdown.empty();\n      }\n\n      this.dropdown.open();\n    }\n  },\n  _onBlurred: function onBlurred() {\n    var cursorDatum;\n    var topSuggestionDatum;\n    cursorDatum = this.dropdown.getDatumForCursor();\n    topSuggestionDatum = this.dropdown.getDatumForTopSuggestion();\n    var context = {\n      selectionMethod: 'blur'\n    };\n\n    if (!this.debug) {\n      if (this.autoselectOnBlur && cursorDatum) {\n        this._select(cursorDatum, context);\n      } else if (this.autoselectOnBlur && topSuggestionDatum) {\n        this._select(topSuggestionDatum, context);\n      } else {\n        this.isActivated = false;\n        this.dropdown.empty();\n        this.dropdown.close();\n      }\n    }\n  },\n  _onEnterKeyed: function onEnterKeyed(type, $e) {\n    var cursorDatum;\n    var topSuggestionDatum;\n    cursorDatum = this.dropdown.getDatumForCursor();\n    topSuggestionDatum = this.dropdown.getDatumForTopSuggestion();\n    var context = {\n      selectionMethod: 'enterKey'\n    };\n\n    if (cursorDatum) {\n      this._select(cursorDatum, context);\n\n      $e.preventDefault();\n    } else if (this.autoselect && topSuggestionDatum) {\n      this._select(topSuggestionDatum, context);\n\n      $e.preventDefault();\n    }\n  },\n  _onTabKeyed: function onTabKeyed(type, $e) {\n    if (!this.tabAutocomplete) {\n      // Closing the dropdown enables further tabbing\n      this.dropdown.close();\n      return;\n    }\n\n    var datum;\n    var context = {\n      selectionMethod: 'tabKey'\n    };\n\n    if (datum = this.dropdown.getDatumForCursor()) {\n      this._select(datum, context);\n\n      $e.preventDefault();\n    } else {\n      this._autocomplete(true);\n    }\n  },\n  _onEscKeyed: function onEscKeyed() {\n    this.dropdown.close();\n    this.input.resetInputValue();\n  },\n  _onUpKeyed: function onUpKeyed() {\n    var query = this.input.getQuery();\n\n    if (this.dropdown.isEmpty && query.length >= this.minLength) {\n      this.dropdown.update(query);\n    } else {\n      this.dropdown.moveCursorUp();\n    }\n\n    this.dropdown.open();\n  },\n  _onDownKeyed: function onDownKeyed() {\n    var query = this.input.getQuery();\n\n    if (this.dropdown.isEmpty && query.length >= this.minLength) {\n      this.dropdown.update(query);\n    } else {\n      this.dropdown.moveCursorDown();\n    }\n\n    this.dropdown.open();\n  },\n  _onLeftKeyed: function onLeftKeyed() {\n    if (this.dir === 'rtl') {\n      this._autocomplete();\n    }\n  },\n  _onRightKeyed: function onRightKeyed() {\n    if (this.dir === 'ltr') {\n      this._autocomplete();\n    }\n  },\n  _onQueryChanged: function onQueryChanged(e, query) {\n    this.input.clearHintIfInvalid();\n\n    if (query.length >= this.minLength) {\n      this.dropdown.update(query);\n    } else {\n      this.dropdown.empty();\n    }\n\n    this.dropdown.open();\n\n    this._setLanguageDirection();\n  },\n  _onWhitespaceChanged: function onWhitespaceChanged() {\n    this._updateHint();\n\n    this.dropdown.open();\n  },\n  _setLanguageDirection: function setLanguageDirection() {\n    var dir = this.input.getLanguageDirection();\n\n    if (this.dir !== dir) {\n      this.dir = dir;\n      this.$node.css('direction', dir);\n      this.dropdown.setLanguageDirection(dir);\n    }\n  },\n  _updateHint: function updateHint() {\n    var datum;\n    var val;\n    var query;\n    var escapedQuery;\n    var frontMatchRegEx;\n    var match;\n    datum = this.dropdown.getDatumForTopSuggestion();\n\n    if (datum && this.dropdown.isVisible() && !this.input.hasOverflow()) {\n      val = this.input.getInputValue();\n      query = Input.normalizeQuery(val);\n      escapedQuery = _.escapeRegExChars(query); // match input value, then capture trailing text\n\n      frontMatchRegEx = new RegExp('^(?:' + escapedQuery + ')(.+$)', 'i');\n      match = frontMatchRegEx.exec(datum.value); // clear hint if there's no trailing text\n\n      if (match) {\n        this.input.setHint(val + match[1]);\n      } else {\n        this.input.clearHint();\n      }\n    } else {\n      this.input.clearHint();\n    }\n  },\n  _autocomplete: function autocomplete(laxCursor) {\n    var hint;\n    var query;\n    var isCursorAtEnd;\n    var datum;\n    hint = this.input.getHint();\n    query = this.input.getQuery();\n    isCursorAtEnd = laxCursor || this.input.isCursorAtEnd();\n\n    if (hint && query !== hint && isCursorAtEnd) {\n      datum = this.dropdown.getDatumForTopSuggestion();\n\n      if (datum) {\n        this.input.setInputValue(datum.value);\n      }\n\n      this.eventBus.trigger('autocompleted', datum.raw, datum.datasetName);\n    }\n  },\n  _select: function select(datum, context) {\n    if (typeof datum.value !== 'undefined') {\n      this.input.setQuery(datum.value);\n    }\n\n    if (this.clearOnSelected) {\n      this.setVal('');\n    } else {\n      this.input.setInputValue(datum.value, true);\n    }\n\n    this._setLanguageDirection();\n\n    var event = this.eventBus.trigger('selected', datum.raw, datum.datasetName, context);\n\n    if (event.isDefaultPrevented() === false) {\n      this.dropdown.close(); // #118: allow click event to bubble up to the body before removing\n      // the suggestions otherwise we break event delegation\n\n      _.defer(_.bind(this.dropdown.empty, this.dropdown));\n    }\n  },\n  // ### public\n  open: function open() {\n    // if the menu is not activated yet, we need to update\n    // the underlying dropdown menu to trigger the search\n    // otherwise we're not gonna see anything\n    if (!this.isActivated) {\n      var query = this.input.getInputValue();\n\n      if (query.length >= this.minLength) {\n        this.dropdown.update(query);\n      } else {\n        this.dropdown.empty();\n      }\n    }\n\n    this.dropdown.open();\n  },\n  close: function close() {\n    this.dropdown.close();\n  },\n  setVal: function setVal(val) {\n    // expect val to be a string, so be safe, and coerce\n    val = _.toStr(val);\n\n    if (this.isActivated) {\n      this.input.setInputValue(val);\n    } else {\n      this.input.setQuery(val);\n      this.input.setInputValue(val, true);\n    }\n\n    this._setLanguageDirection();\n  },\n  getVal: function getVal() {\n    return this.input.getQuery();\n  },\n  destroy: function destroy() {\n    this.input.destroy();\n    this.dropdown.destroy();\n    destroyDomStructure(this.$node, this.cssClasses);\n    this.$node = null;\n  },\n  getWrapper: function getWrapper() {\n    return this.dropdown.$container[0];\n  }\n});\n\nfunction buildDom(options) {\n  var $input;\n  var $wrapper;\n  var $dropdown;\n  var $hint;\n  $input = DOM.element(options.input);\n  $wrapper = DOM.element(html.wrapper.replace('%ROOT%', options.cssClasses.root)).css(options.css.wrapper); // override the display property with the table-cell value\n  // if the parent element is a table and the original input was a block\n  //  -> https://github.com/algolia/autocomplete.js/issues/16\n\n  if (!options.appendTo && $input.css('display') === 'block' && $input.parent().css('display') === 'table') {\n    $wrapper.css('display', 'table-cell');\n  }\n\n  var dropdownHtml = html.dropdown.replace('%PREFIX%', options.cssClasses.prefix).replace('%DROPDOWN_MENU%', options.cssClasses.dropdownMenu);\n  $dropdown = DOM.element(dropdownHtml).css(options.css.dropdown).attr({\n    role: 'listbox',\n    id: options.listboxId\n  });\n\n  if (options.templates && options.templates.dropdownMenu) {\n    $dropdown.html(_.templatify(options.templates.dropdownMenu)());\n  }\n\n  $hint = $input.clone().css(options.css.hint).css(getBackgroundStyles($input));\n  $hint.val('').addClass(_.className(options.cssClasses.prefix, options.cssClasses.hint, true)).removeAttr('id name placeholder required').prop('readonly', true).attr({\n    'aria-hidden': 'true',\n    autocomplete: 'off',\n    spellcheck: 'false',\n    tabindex: -1\n  });\n\n  if ($hint.removeData) {\n    $hint.removeData();\n  } // store the original values of the attrs that get modified\n  // so modifications can be reverted on destroy\n\n\n  $input.data(attrsKey, {\n    'aria-autocomplete': $input.attr('aria-autocomplete'),\n    'aria-expanded': $input.attr('aria-expanded'),\n    'aria-owns': $input.attr('aria-owns'),\n    autocomplete: $input.attr('autocomplete'),\n    dir: $input.attr('dir'),\n    role: $input.attr('role'),\n    spellcheck: $input.attr('spellcheck'),\n    style: $input.attr('style'),\n    type: $input.attr('type')\n  });\n  $input.addClass(_.className(options.cssClasses.prefix, options.cssClasses.input, true)).attr({\n    autocomplete: 'off',\n    spellcheck: false,\n    // Accessibility features\n    // Give the field a presentation of a \"select\".\n    // Combobox is the combined presentation of a single line textfield\n    // with a listbox popup.\n    // https://www.w3.org/WAI/PF/aria/roles#combobox\n    role: 'combobox',\n    // Let the screen reader know the field has an autocomplete\n    // feature to it.\n    'aria-autocomplete': options.datasets && options.datasets[0] && options.datasets[0].displayKey ? 'both' : 'list',\n    // Indicates whether the dropdown it controls is currently expanded or collapsed\n    'aria-expanded': 'false',\n    'aria-label': options.ariaLabel,\n    // Explicitly point to the listbox,\n    // which is a list of suggestions (aka options)\n    'aria-owns': options.listboxId\n  }).css(options.hint ? options.css.input : options.css.inputWithNoHint); // ie7 does not like it when dir is set to auto\n\n  try {\n    if (!$input.attr('dir')) {\n      $input.attr('dir', 'auto');\n    }\n  } catch (e) {// ignore\n  }\n\n  $wrapper = options.appendTo ? $wrapper.appendTo(DOM.element(options.appendTo).eq(0)).eq(0) : $input.wrap($wrapper).parent();\n  $wrapper.prepend(options.hint ? $hint : null).append($dropdown);\n  return {\n    wrapper: $wrapper,\n    input: $input,\n    hint: $hint,\n    menu: $dropdown\n  };\n}\n\nfunction getBackgroundStyles($el) {\n  return {\n    backgroundAttachment: $el.css('background-attachment'),\n    backgroundClip: $el.css('background-clip'),\n    backgroundColor: $el.css('background-color'),\n    backgroundImage: $el.css('background-image'),\n    backgroundOrigin: $el.css('background-origin'),\n    backgroundPosition: $el.css('background-position'),\n    backgroundRepeat: $el.css('background-repeat'),\n    backgroundSize: $el.css('background-size')\n  };\n}\n\nfunction destroyDomStructure($node, cssClasses) {\n  var $input = $node.find(_.className(cssClasses.prefix, cssClasses.input)); // need to remove attrs that weren't previously defined and\n  // revert attrs that originally had a value\n\n  _.each($input.data(attrsKey), function (val, key) {\n    if (val === undefined) {\n      $input.removeAttr(key);\n    } else {\n      $input.attr(key, val);\n    }\n  });\n\n  $input.detach().removeClass(_.className(cssClasses.prefix, cssClasses.input, true)).insertAfter($node);\n\n  if ($input.removeData) {\n    $input.removeData(attrsKey);\n  }\n\n  $node.remove();\n}\n\nTypeahead.Dropdown = Dropdown;\nTypeahead.Input = Input;\nTypeahead.sources = require('../sources/index.js');\nmodule.exports = Typeahead;","map":{"version":3,"sources":["/home/kali/Documents/cybersecurity/client/node_modules/autocomplete.js/src/autocomplete/typeahead.js"],"names":["attrsKey","_","require","DOM","EventBus","Input","Dropdown","html","css","Typeahead","o","$menu","$hint","input","error","isActivated","debug","autoselect","autoselectOnBlur","openOnFocus","minLength","isNumber","autoWidth","undefined","clearOnSelected","tabAutocomplete","hint","appendTo","Error","mixin","cssClasses","defaultClasses","prefix","formattedPrefix","formatPrefix","noPrefix","listboxId","root","getUniqueId","join","domElts","buildDom","$node","wrapper","$input","menu","dropdownMenuContainer","element","append","on","$e","active","document","activeElement","isMsie","contains","preventDefault","stopImmediatePropagation","defer","focus","eventBus","el","dropdown","datasets","templates","onSync","_onSuggestionClicked","_onCursorMoved","_onCursorRemoved","_onOpened","_onClosed","_onShown","_onEmpty","_onRedrawn","onAsync","_onDatasetRendered","_onFocused","_onBlurred","_onEnterKeyed","_onTabKeyed","_onEscKeyed","_onUpKeyed","_onDownKeyed","_onLeftKeyed","_onRightKeyed","_onQueryChanged","_onWhitespaceChanged","_bindKeyboardShortcuts","_setLanguageDirection","prototype","options","keyboardShortcuts","each","key","toUpperCase","charCodeAt","push","keydown","event","elt","target","srcElement","tagName","isContentEditable","which","keyCode","indexOf","stopPropagation","onSuggestionClicked","type","$el","datum","context","selectionMethod","getDatumForSuggestion","_select","onCursorMoved","updateInput","getDatumForCursor","currentCursorId","getCurrentCursor","attr","setActiveDescendant","setInputValue","value","trigger","raw","datasetName","onCursorRemoved","resetInputValue","_updateHint","onDatasetRendered","onOpened","expand","onEmpty","onRedrawn","inputRect","getBoundingClientRect","width","wrapperRect","top","bottom","left","onShown","cursorTopSuggestion","onClosed","clearHint","removeActiveDescendant","collapse","onFocused","query","getQuery","length","update","empty","open","onBlurred","cursorDatum","topSuggestionDatum","getDatumForTopSuggestion","close","onEnterKeyed","onTabKeyed","_autocomplete","onEscKeyed","onUpKeyed","isEmpty","moveCursorUp","onDownKeyed","moveCursorDown","onLeftKeyed","dir","onRightKeyed","onQueryChanged","e","clearHintIfInvalid","onWhitespaceChanged","setLanguageDirection","getLanguageDirection","updateHint","val","escapedQuery","frontMatchRegEx","match","isVisible","hasOverflow","getInputValue","normalizeQuery","escapeRegExChars","RegExp","exec","setHint","autocomplete","laxCursor","isCursorAtEnd","getHint","select","setQuery","setVal","isDefaultPrevented","bind","toStr","getVal","destroy","destroyDomStructure","getWrapper","$container","$wrapper","$dropdown","replace","parent","dropdownHtml","dropdownMenu","role","id","templatify","clone","getBackgroundStyles","addClass","className","removeAttr","prop","spellcheck","tabindex","removeData","data","style","displayKey","ariaLabel","inputWithNoHint","eq","wrap","prepend","backgroundAttachment","backgroundClip","backgroundColor","backgroundImage","backgroundOrigin","backgroundPosition","backgroundRepeat","backgroundSize","find","detach","removeClass","insertAfter","remove","sources","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar attrsKey = 'aaAttrs';\n\nvar _ = require('../common/utils.js');\nvar DOM = require('../common/dom.js');\nvar EventBus = require('./event_bus.js');\nvar Input = require('./input.js');\nvar Dropdown = require('./dropdown.js');\nvar html = require('./html.js');\nvar css = require('./css.js');\n\n// constructor\n// -----------\n\n// THOUGHT: what if datasets could dynamically be added/removed?\nfunction Typeahead(o) {\n  var $menu;\n  var $hint;\n\n  o = o || {};\n\n  if (!o.input) {\n    _.error('missing input');\n  }\n\n  this.isActivated = false;\n  this.debug = !!o.debug;\n  this.autoselect = !!o.autoselect;\n  this.autoselectOnBlur = !!o.autoselectOnBlur;\n  this.openOnFocus = !!o.openOnFocus;\n  this.minLength = _.isNumber(o.minLength) ? o.minLength : 1;\n  this.autoWidth = (o.autoWidth === undefined) ? true : !!o.autoWidth;\n  this.clearOnSelected = !!o.clearOnSelected;\n  this.tabAutocomplete = (o.tabAutocomplete === undefined) ? true : !!o.tabAutocomplete;\n\n  o.hint = !!o.hint;\n\n  if (o.hint && o.appendTo) {\n    throw new Error('[autocomplete.js] hint and appendTo options can\\'t be used at the same time');\n  }\n\n  this.css = o.css = _.mixin({}, css, o.appendTo ? css.appendTo : {});\n  this.cssClasses = o.cssClasses = _.mixin({}, css.defaultClasses, o.cssClasses || {});\n  this.cssClasses.prefix =\n    o.cssClasses.formattedPrefix = _.formatPrefix(this.cssClasses.prefix, this.cssClasses.noPrefix);\n  this.listboxId = o.listboxId = [this.cssClasses.root, 'listbox', _.getUniqueId()].join('-');\n\n  var domElts = buildDom(o);\n\n  this.$node = domElts.wrapper;\n  var $input = this.$input = domElts.input;\n  $menu = domElts.menu;\n  $hint = domElts.hint;\n\n  if (o.dropdownMenuContainer) {\n    DOM.element(o.dropdownMenuContainer)\n      .css('position', 'relative') // ensure the container has a relative position\n      .append($menu.css('top', '0')); // override the top: 100%\n  }\n\n  // #705: if there's scrollable overflow, ie doesn't support\n  // blur cancellations when the scrollbar is clicked\n  //\n  // #351: preventDefault won't cancel blurs in ie <= 8\n  $input.on('blur.aa', function($e) {\n    var active = document.activeElement;\n    if (_.isMsie() && ($menu[0] === active || $menu[0].contains(active))) {\n      $e.preventDefault();\n      // stop immediate in order to prevent Input#_onBlur from\n      // getting exectued\n      $e.stopImmediatePropagation();\n      _.defer(function() { $input.focus(); });\n    }\n  });\n\n  // #351: prevents input blur due to clicks within dropdown menu\n  $menu.on('mousedown.aa', function($e) { $e.preventDefault(); });\n\n  this.eventBus = o.eventBus || new EventBus({el: $input});\n\n  this.dropdown = new Typeahead.Dropdown({\n    appendTo: o.appendTo,\n    wrapper: this.$node,\n    menu: $menu,\n    datasets: o.datasets,\n    templates: o.templates,\n    cssClasses: o.cssClasses,\n    minLength: this.minLength\n  })\n    .onSync('suggestionClicked', this._onSuggestionClicked, this)\n    .onSync('cursorMoved', this._onCursorMoved, this)\n    .onSync('cursorRemoved', this._onCursorRemoved, this)\n    .onSync('opened', this._onOpened, this)\n    .onSync('closed', this._onClosed, this)\n    .onSync('shown', this._onShown, this)\n    .onSync('empty', this._onEmpty, this)\n    .onSync('redrawn', this._onRedrawn, this)\n    .onAsync('datasetRendered', this._onDatasetRendered, this);\n\n  this.input = new Typeahead.Input({input: $input, hint: $hint})\n    .onSync('focused', this._onFocused, this)\n    .onSync('blurred', this._onBlurred, this)\n    .onSync('enterKeyed', this._onEnterKeyed, this)\n    .onSync('tabKeyed', this._onTabKeyed, this)\n    .onSync('escKeyed', this._onEscKeyed, this)\n    .onSync('upKeyed', this._onUpKeyed, this)\n    .onSync('downKeyed', this._onDownKeyed, this)\n    .onSync('leftKeyed', this._onLeftKeyed, this)\n    .onSync('rightKeyed', this._onRightKeyed, this)\n    .onSync('queryChanged', this._onQueryChanged, this)\n    .onSync('whitespaceChanged', this._onWhitespaceChanged, this);\n\n  this._bindKeyboardShortcuts(o);\n\n  this._setLanguageDirection();\n}\n\n// instance methods\n// ----------------\n\n_.mixin(Typeahead.prototype, {\n  // ### private\n\n  _bindKeyboardShortcuts: function(options) {\n    if (!options.keyboardShortcuts) {\n      return;\n    }\n    var $input = this.$input;\n    var keyboardShortcuts = [];\n    _.each(options.keyboardShortcuts, function(key) {\n      if (typeof key === 'string') {\n        key = key.toUpperCase().charCodeAt(0);\n      }\n      keyboardShortcuts.push(key);\n    });\n    DOM.element(document).keydown(function(event) {\n      var elt = (event.target || event.srcElement);\n      var tagName = elt.tagName;\n      if (elt.isContentEditable || tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA') {\n        // already in an input\n        return;\n      }\n\n      var which = event.which || event.keyCode;\n      if (keyboardShortcuts.indexOf(which) === -1) {\n        // not the right shortcut\n        return;\n      }\n\n      $input.focus();\n      event.stopPropagation();\n      event.preventDefault();\n    });\n  },\n\n  _onSuggestionClicked: function onSuggestionClicked(type, $el) {\n    var datum;\n    var context = {selectionMethod: 'click'};\n\n    if (datum = this.dropdown.getDatumForSuggestion($el)) {\n      this._select(datum, context);\n    }\n  },\n\n  _onCursorMoved: function onCursorMoved(event, updateInput) {\n    var datum = this.dropdown.getDatumForCursor();\n    var currentCursorId = this.dropdown.getCurrentCursor().attr('id');\n    this.input.setActiveDescendant(currentCursorId);\n\n    if (datum) {\n      if (updateInput) {\n        this.input.setInputValue(datum.value, true);\n      }\n\n      this.eventBus.trigger('cursorchanged', datum.raw, datum.datasetName);\n    }\n  },\n\n  _onCursorRemoved: function onCursorRemoved() {\n    this.input.resetInputValue();\n    this._updateHint();\n    this.eventBus.trigger('cursorremoved');\n  },\n\n  _onDatasetRendered: function onDatasetRendered() {\n    this._updateHint();\n\n    this.eventBus.trigger('updated');\n  },\n\n  _onOpened: function onOpened() {\n    this._updateHint();\n    this.input.expand();\n\n    this.eventBus.trigger('opened');\n  },\n\n  _onEmpty: function onEmpty() {\n    this.eventBus.trigger('empty');\n  },\n\n  _onRedrawn: function onRedrawn() {\n    this.$node.css('top', 0 + 'px');\n    this.$node.css('left', 0 + 'px');\n\n    var inputRect = this.$input[0].getBoundingClientRect();\n\n    if (this.autoWidth) {\n      this.$node.css('width', inputRect.width + 'px');\n    }\n\n    var wrapperRect = this.$node[0].getBoundingClientRect();\n\n    var top = inputRect.bottom - wrapperRect.top;\n    this.$node.css('top', top + 'px');\n    var left = inputRect.left - wrapperRect.left;\n    this.$node.css('left', left + 'px');\n\n    this.eventBus.trigger('redrawn');\n  },\n\n  _onShown: function onShown() {\n    this.eventBus.trigger('shown');\n    if (this.autoselect) {\n      this.dropdown.cursorTopSuggestion();\n    }\n  },\n\n  _onClosed: function onClosed() {\n    this.input.clearHint();\n    this.input.removeActiveDescendant();\n    this.input.collapse();\n\n    this.eventBus.trigger('closed');\n  },\n\n  _onFocused: function onFocused() {\n    this.isActivated = true;\n\n    if (this.openOnFocus) {\n      var query = this.input.getQuery();\n      if (query.length >= this.minLength) {\n        this.dropdown.update(query);\n      } else {\n        this.dropdown.empty();\n      }\n\n      this.dropdown.open();\n    }\n  },\n\n  _onBlurred: function onBlurred() {\n    var cursorDatum;\n    var topSuggestionDatum;\n\n    cursorDatum = this.dropdown.getDatumForCursor();\n    topSuggestionDatum = this.dropdown.getDatumForTopSuggestion();\n    var context = {selectionMethod: 'blur'};\n\n    if (!this.debug) {\n      if (this.autoselectOnBlur && cursorDatum) {\n        this._select(cursorDatum, context);\n      } else if (this.autoselectOnBlur && topSuggestionDatum) {\n        this._select(topSuggestionDatum, context);\n      } else {\n        this.isActivated = false;\n        this.dropdown.empty();\n        this.dropdown.close();\n      }\n    }\n  },\n\n  _onEnterKeyed: function onEnterKeyed(type, $e) {\n    var cursorDatum;\n    var topSuggestionDatum;\n\n    cursorDatum = this.dropdown.getDatumForCursor();\n    topSuggestionDatum = this.dropdown.getDatumForTopSuggestion();\n    var context = {selectionMethod: 'enterKey'};\n\n    if (cursorDatum) {\n      this._select(cursorDatum, context);\n      $e.preventDefault();\n    } else if (this.autoselect && topSuggestionDatum) {\n      this._select(topSuggestionDatum, context);\n      $e.preventDefault();\n    }\n  },\n\n  _onTabKeyed: function onTabKeyed(type, $e) {\n    if (!this.tabAutocomplete) {\n      // Closing the dropdown enables further tabbing\n      this.dropdown.close();\n      return;\n    }\n\n    var datum;\n    var context = {selectionMethod: 'tabKey'};\n\n    if (datum = this.dropdown.getDatumForCursor()) {\n      this._select(datum, context);\n      $e.preventDefault();\n    } else {\n      this._autocomplete(true);\n    }\n  },\n\n  _onEscKeyed: function onEscKeyed() {\n    this.dropdown.close();\n    this.input.resetInputValue();\n  },\n\n  _onUpKeyed: function onUpKeyed() {\n    var query = this.input.getQuery();\n\n    if (this.dropdown.isEmpty && query.length >= this.minLength) {\n      this.dropdown.update(query);\n    } else {\n      this.dropdown.moveCursorUp();\n    }\n\n    this.dropdown.open();\n  },\n\n  _onDownKeyed: function onDownKeyed() {\n    var query = this.input.getQuery();\n\n    if (this.dropdown.isEmpty && query.length >= this.minLength) {\n      this.dropdown.update(query);\n    } else {\n      this.dropdown.moveCursorDown();\n    }\n\n    this.dropdown.open();\n  },\n\n  _onLeftKeyed: function onLeftKeyed() {\n    if (this.dir === 'rtl') {\n      this._autocomplete();\n    }\n  },\n\n  _onRightKeyed: function onRightKeyed() {\n    if (this.dir === 'ltr') {\n      this._autocomplete();\n    }\n  },\n\n  _onQueryChanged: function onQueryChanged(e, query) {\n    this.input.clearHintIfInvalid();\n\n    if (query.length >= this.minLength) {\n      this.dropdown.update(query);\n    } else {\n      this.dropdown.empty();\n    }\n\n    this.dropdown.open();\n    this._setLanguageDirection();\n  },\n\n  _onWhitespaceChanged: function onWhitespaceChanged() {\n    this._updateHint();\n    this.dropdown.open();\n  },\n\n  _setLanguageDirection: function setLanguageDirection() {\n    var dir = this.input.getLanguageDirection();\n\n    if (this.dir !== dir) {\n      this.dir = dir;\n      this.$node.css('direction', dir);\n      this.dropdown.setLanguageDirection(dir);\n    }\n  },\n\n  _updateHint: function updateHint() {\n    var datum;\n    var val;\n    var query;\n    var escapedQuery;\n    var frontMatchRegEx;\n    var match;\n\n    datum = this.dropdown.getDatumForTopSuggestion();\n\n    if (datum && this.dropdown.isVisible() && !this.input.hasOverflow()) {\n      val = this.input.getInputValue();\n      query = Input.normalizeQuery(val);\n      escapedQuery = _.escapeRegExChars(query);\n\n      // match input value, then capture trailing text\n      frontMatchRegEx = new RegExp('^(?:' + escapedQuery + ')(.+$)', 'i');\n      match = frontMatchRegEx.exec(datum.value);\n\n      // clear hint if there's no trailing text\n      if (match) {\n        this.input.setHint(val + match[1]);\n      } else {\n        this.input.clearHint();\n      }\n    } else {\n      this.input.clearHint();\n    }\n  },\n\n  _autocomplete: function autocomplete(laxCursor) {\n    var hint;\n    var query;\n    var isCursorAtEnd;\n    var datum;\n\n    hint = this.input.getHint();\n    query = this.input.getQuery();\n    isCursorAtEnd = laxCursor || this.input.isCursorAtEnd();\n\n    if (hint && query !== hint && isCursorAtEnd) {\n      datum = this.dropdown.getDatumForTopSuggestion();\n      if (datum) {\n        this.input.setInputValue(datum.value);\n      }\n\n      this.eventBus.trigger('autocompleted', datum.raw, datum.datasetName);\n    }\n  },\n\n  _select: function select(datum, context) {\n    if (typeof datum.value !== 'undefined') {\n      this.input.setQuery(datum.value);\n    }\n    if (this.clearOnSelected) {\n      this.setVal('');\n    } else {\n      this.input.setInputValue(datum.value, true);\n    }\n\n    this._setLanguageDirection();\n\n    var event = this.eventBus.trigger('selected', datum.raw, datum.datasetName, context);\n    if (event.isDefaultPrevented() === false) {\n      this.dropdown.close();\n\n      // #118: allow click event to bubble up to the body before removing\n      // the suggestions otherwise we break event delegation\n      _.defer(_.bind(this.dropdown.empty, this.dropdown));\n    }\n  },\n\n  // ### public\n\n  open: function open() {\n    // if the menu is not activated yet, we need to update\n    // the underlying dropdown menu to trigger the search\n    // otherwise we're not gonna see anything\n    if (!this.isActivated) {\n      var query = this.input.getInputValue();\n      if (query.length >= this.minLength) {\n        this.dropdown.update(query);\n      } else {\n        this.dropdown.empty();\n      }\n    }\n    this.dropdown.open();\n  },\n\n  close: function close() {\n    this.dropdown.close();\n  },\n\n  setVal: function setVal(val) {\n    // expect val to be a string, so be safe, and coerce\n    val = _.toStr(val);\n\n    if (this.isActivated) {\n      this.input.setInputValue(val);\n    } else {\n      this.input.setQuery(val);\n      this.input.setInputValue(val, true);\n    }\n\n    this._setLanguageDirection();\n  },\n\n  getVal: function getVal() {\n    return this.input.getQuery();\n  },\n\n  destroy: function destroy() {\n    this.input.destroy();\n    this.dropdown.destroy();\n\n    destroyDomStructure(this.$node, this.cssClasses);\n\n    this.$node = null;\n  },\n\n  getWrapper: function getWrapper() {\n    return this.dropdown.$container[0];\n  }\n});\n\nfunction buildDom(options) {\n  var $input;\n  var $wrapper;\n  var $dropdown;\n  var $hint;\n\n  $input = DOM.element(options.input);\n  $wrapper = DOM\n    .element(html.wrapper.replace('%ROOT%', options.cssClasses.root))\n    .css(options.css.wrapper);\n\n  // override the display property with the table-cell value\n  // if the parent element is a table and the original input was a block\n  //  -> https://github.com/algolia/autocomplete.js/issues/16\n  if (!options.appendTo && $input.css('display') === 'block' && $input.parent().css('display') === 'table') {\n    $wrapper.css('display', 'table-cell');\n  }\n  var dropdownHtml = html.dropdown.\n    replace('%PREFIX%', options.cssClasses.prefix).\n    replace('%DROPDOWN_MENU%', options.cssClasses.dropdownMenu);\n  $dropdown = DOM.element(dropdownHtml)\n    .css(options.css.dropdown)\n    .attr({\n      role: 'listbox',\n      id: options.listboxId\n    });\n  if (options.templates && options.templates.dropdownMenu) {\n    $dropdown.html(_.templatify(options.templates.dropdownMenu)());\n  }\n  $hint = $input.clone().css(options.css.hint).css(getBackgroundStyles($input));\n\n  $hint\n    .val('')\n    .addClass(_.className(options.cssClasses.prefix, options.cssClasses.hint, true))\n    .removeAttr('id name placeholder required')\n    .prop('readonly', true)\n    .attr({\n      'aria-hidden': 'true',\n      autocomplete: 'off',\n      spellcheck: 'false',\n      tabindex: -1\n    });\n  if ($hint.removeData) {\n    $hint.removeData();\n  }\n\n  // store the original values of the attrs that get modified\n  // so modifications can be reverted on destroy\n  $input.data(attrsKey, {\n    'aria-autocomplete': $input.attr('aria-autocomplete'),\n    'aria-expanded': $input.attr('aria-expanded'),\n    'aria-owns': $input.attr('aria-owns'),\n    autocomplete: $input.attr('autocomplete'),\n    dir: $input.attr('dir'),\n    role: $input.attr('role'),\n    spellcheck: $input.attr('spellcheck'),\n    style: $input.attr('style'),\n    type: $input.attr('type')\n  });\n\n  $input\n    .addClass(_.className(options.cssClasses.prefix, options.cssClasses.input, true))\n    .attr({\n      autocomplete: 'off',\n      spellcheck: false,\n\n      // Accessibility features\n      // Give the field a presentation of a \"select\".\n      // Combobox is the combined presentation of a single line textfield\n      // with a listbox popup.\n      // https://www.w3.org/WAI/PF/aria/roles#combobox\n      role: 'combobox',\n      // Let the screen reader know the field has an autocomplete\n      // feature to it.\n      'aria-autocomplete': (options.datasets &&\n        options.datasets[0] && options.datasets[0].displayKey ? 'both' : 'list'),\n      // Indicates whether the dropdown it controls is currently expanded or collapsed\n      'aria-expanded': 'false',\n      'aria-label': options.ariaLabel,\n      // Explicitly point to the listbox,\n      // which is a list of suggestions (aka options)\n      'aria-owns': options.listboxId\n    })\n    .css(options.hint ? options.css.input : options.css.inputWithNoHint);\n\n  // ie7 does not like it when dir is set to auto\n  try {\n    if (!$input.attr('dir')) {\n      $input.attr('dir', 'auto');\n    }\n  } catch (e) {\n    // ignore\n  }\n\n  $wrapper = options.appendTo\n    ? $wrapper.appendTo(DOM.element(options.appendTo).eq(0)).eq(0)\n    : $input.wrap($wrapper).parent();\n\n  $wrapper\n    .prepend(options.hint ? $hint : null)\n    .append($dropdown);\n\n  return {\n    wrapper: $wrapper,\n    input: $input,\n    hint: $hint,\n    menu: $dropdown\n  };\n}\n\nfunction getBackgroundStyles($el) {\n  return {\n    backgroundAttachment: $el.css('background-attachment'),\n    backgroundClip: $el.css('background-clip'),\n    backgroundColor: $el.css('background-color'),\n    backgroundImage: $el.css('background-image'),\n    backgroundOrigin: $el.css('background-origin'),\n    backgroundPosition: $el.css('background-position'),\n    backgroundRepeat: $el.css('background-repeat'),\n    backgroundSize: $el.css('background-size')\n  };\n}\n\nfunction destroyDomStructure($node, cssClasses) {\n  var $input = $node.find(_.className(cssClasses.prefix, cssClasses.input));\n\n  // need to remove attrs that weren't previously defined and\n  // revert attrs that originally had a value\n  _.each($input.data(attrsKey), function(val, key) {\n    if (val === undefined) {\n      $input.removeAttr(key);\n    } else {\n      $input.attr(key, val);\n    }\n  });\n\n  $input\n    .detach()\n    .removeClass(_.className(cssClasses.prefix, cssClasses.input, true))\n    .insertAfter($node);\n  if ($input.removeData) {\n    $input.removeData(attrsKey);\n  }\n\n  $node.remove();\n}\n\nTypeahead.Dropdown = Dropdown;\nTypeahead.Input = Input;\nTypeahead.sources = require('../sources/index.js');\n\nmodule.exports = Typeahead;\n"]},"metadata":{},"sourceType":"script"}