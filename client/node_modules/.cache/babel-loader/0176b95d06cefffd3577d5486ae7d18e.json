{"ast":null,"code":"'use strict';\n\nvar _ = require('../common/utils.js');\n\nvar DOM = require('../common/dom.js');\n\nvar EventEmitter = require('./event_emitter.js');\n\nvar Dataset = require('./dataset.js');\n\nvar css = require('./css.js'); // constructor\n// -----------\n\n\nfunction Dropdown(o) {\n  var that = this;\n  var onSuggestionClick;\n  var onSuggestionMouseEnter;\n  var onSuggestionMouseLeave;\n  o = o || {};\n\n  if (!o.menu) {\n    _.error('menu is required');\n  }\n\n  if (!_.isArray(o.datasets) && !_.isObject(o.datasets)) {\n    _.error('1 or more datasets required');\n  }\n\n  if (!o.datasets) {\n    _.error('datasets is required');\n  }\n\n  this.isOpen = false;\n  this.isEmpty = true;\n  this.minLength = o.minLength || 0;\n  this.templates = {};\n  this.appendTo = o.appendTo || false;\n  this.css = _.mixin({}, css, o.appendTo ? css.appendTo : {});\n  this.cssClasses = o.cssClasses = _.mixin({}, css.defaultClasses, o.cssClasses || {});\n  this.cssClasses.prefix = o.cssClasses.formattedPrefix || _.formatPrefix(this.cssClasses.prefix, this.cssClasses.noPrefix); // bound functions\n\n  onSuggestionClick = _.bind(this._onSuggestionClick, this);\n  onSuggestionMouseEnter = _.bind(this._onSuggestionMouseEnter, this);\n  onSuggestionMouseLeave = _.bind(this._onSuggestionMouseLeave, this);\n\n  var cssClass = _.className(this.cssClasses.prefix, this.cssClasses.suggestion);\n\n  this.$menu = DOM.element(o.menu).on('mouseenter.aa', cssClass, onSuggestionMouseEnter).on('mouseleave.aa', cssClass, onSuggestionMouseLeave).on('click.aa', cssClass, onSuggestionClick);\n  this.$container = o.appendTo ? o.wrapper : this.$menu;\n\n  if (o.templates && o.templates.header) {\n    this.templates.header = _.templatify(o.templates.header);\n    this.$menu.prepend(this.templates.header());\n  }\n\n  if (o.templates && o.templates.empty) {\n    this.templates.empty = _.templatify(o.templates.empty);\n    this.$empty = DOM.element('<div class=\"' + _.className(this.cssClasses.prefix, this.cssClasses.empty, true) + '\">' + '</div>');\n    this.$menu.append(this.$empty);\n    this.$empty.hide();\n  }\n\n  this.datasets = _.map(o.datasets, function (oDataset) {\n    return initializeDataset(that.$menu, oDataset, o.cssClasses);\n  });\n\n  _.each(this.datasets, function (dataset) {\n    var root = dataset.getRoot();\n\n    if (root && root.parent().length === 0) {\n      that.$menu.append(root);\n    }\n\n    dataset.onSync('rendered', that._onRendered, that);\n  });\n\n  if (o.templates && o.templates.footer) {\n    this.templates.footer = _.templatify(o.templates.footer);\n    this.$menu.append(this.templates.footer());\n  }\n\n  var self = this;\n  DOM.element(window).resize(function () {\n    self._redraw();\n  });\n} // instance methods\n// ----------------\n\n\n_.mixin(Dropdown.prototype, EventEmitter, {\n  // ### private\n  _onSuggestionClick: function onSuggestionClick($e) {\n    this.trigger('suggestionClicked', DOM.element($e.currentTarget));\n  },\n  _onSuggestionMouseEnter: function onSuggestionMouseEnter($e) {\n    var elt = DOM.element($e.currentTarget);\n\n    if (elt.hasClass(_.className(this.cssClasses.prefix, this.cssClasses.cursor, true))) {\n      // we're already on the cursor\n      // => we're probably entering it again after leaving it for a nested div\n      return;\n    }\n\n    this._removeCursor(); // Fixes iOS double tap behaviour, by modifying the DOM right before the\n    // native href clicks happens, iOS will requires another tap to follow\n    // a suggestion that has an <a href> element inside\n    // https://www.google.com/search?q=ios+double+tap+bug+href\n\n\n    var suggestion = this;\n    setTimeout(function () {\n      // this exact line, when inside the main loop, will trigger a double tap bug\n      // on iOS devices\n      suggestion._setCursor(elt, false);\n    }, 0);\n  },\n  _onSuggestionMouseLeave: function onSuggestionMouseLeave($e) {\n    // $e.relatedTarget is the `EventTarget` the pointing device entered to\n    if ($e.relatedTarget) {\n      var elt = DOM.element($e.relatedTarget);\n\n      if (elt.closest('.' + _.className(this.cssClasses.prefix, this.cssClasses.cursor, true)).length > 0) {\n        // our father is a cursor\n        // => it means we're just leaving the suggestion for a nested div\n        return;\n      }\n    }\n\n    this._removeCursor();\n\n    this.trigger('cursorRemoved');\n  },\n  _onRendered: function onRendered(e, query) {\n    this.isEmpty = _.every(this.datasets, isDatasetEmpty);\n\n    if (this.isEmpty) {\n      if (query.length >= this.minLength) {\n        this.trigger('empty');\n      }\n\n      if (this.$empty) {\n        if (query.length < this.minLength) {\n          this._hide();\n        } else {\n          var html = this.templates.empty({\n            query: this.datasets[0] && this.datasets[0].query\n          });\n          this.$empty.html(html);\n          this.$empty.show();\n\n          this._show();\n        }\n      } else if (_.any(this.datasets, hasEmptyTemplate)) {\n        if (query.length < this.minLength) {\n          this._hide();\n        } else {\n          this._show();\n        }\n      } else {\n        this._hide();\n      }\n    } else if (this.isOpen) {\n      if (this.$empty) {\n        this.$empty.empty();\n        this.$empty.hide();\n      }\n\n      if (query.length >= this.minLength) {\n        this._show();\n      } else {\n        this._hide();\n      }\n    }\n\n    this.trigger('datasetRendered');\n\n    function isDatasetEmpty(dataset) {\n      return dataset.isEmpty();\n    }\n\n    function hasEmptyTemplate(dataset) {\n      return dataset.templates && dataset.templates.empty;\n    }\n  },\n  _hide: function () {\n    this.$container.hide();\n  },\n  _show: function () {\n    // can't use jQuery#show because $menu is a span element we want\n    // display: block; not dislay: inline;\n    this.$container.css('display', 'block');\n\n    this._redraw();\n\n    this.trigger('shown');\n  },\n  _redraw: function redraw() {\n    if (!this.isOpen || !this.appendTo) return;\n    this.trigger('redrawn');\n  },\n  _getSuggestions: function getSuggestions() {\n    return this.$menu.find(_.className(this.cssClasses.prefix, this.cssClasses.suggestion));\n  },\n  _getCursor: function getCursor() {\n    return this.$menu.find(_.className(this.cssClasses.prefix, this.cssClasses.cursor)).first();\n  },\n  _setCursor: function setCursor($el, updateInput) {\n    $el.first().addClass(_.className(this.cssClasses.prefix, this.cssClasses.cursor, true)).attr('aria-selected', 'true');\n    this.trigger('cursorMoved', updateInput);\n  },\n  _removeCursor: function removeCursor() {\n    this._getCursor().removeClass(_.className(this.cssClasses.prefix, this.cssClasses.cursor, true)).removeAttr('aria-selected');\n  },\n  _moveCursor: function moveCursor(increment) {\n    var $suggestions;\n    var $oldCursor;\n    var newCursorIndex;\n    var $newCursor;\n\n    if (!this.isOpen) {\n      return;\n    }\n\n    $oldCursor = this._getCursor();\n    $suggestions = this._getSuggestions();\n\n    this._removeCursor(); // shifting before and after modulo to deal with -1 index\n\n\n    newCursorIndex = $suggestions.index($oldCursor) + increment;\n    newCursorIndex = (newCursorIndex + 1) % ($suggestions.length + 1) - 1;\n\n    if (newCursorIndex === -1) {\n      this.trigger('cursorRemoved');\n      return;\n    } else if (newCursorIndex < -1) {\n      newCursorIndex = $suggestions.length - 1;\n    }\n\n    this._setCursor($newCursor = $suggestions.eq(newCursorIndex), true); // in the case of scrollable overflow\n    // make sure the cursor is visible in the menu\n\n\n    this._ensureVisible($newCursor);\n  },\n  _ensureVisible: function ensureVisible($el) {\n    var elTop;\n    var elBottom;\n    var menuScrollTop;\n    var menuHeight;\n    elTop = $el.position().top;\n    elBottom = elTop + $el.height() + parseInt($el.css('margin-top'), 10) + parseInt($el.css('margin-bottom'), 10);\n    menuScrollTop = this.$menu.scrollTop();\n    menuHeight = this.$menu.height() + parseInt(this.$menu.css('padding-top'), 10) + parseInt(this.$menu.css('padding-bottom'), 10);\n\n    if (elTop < 0) {\n      this.$menu.scrollTop(menuScrollTop + elTop);\n    } else if (menuHeight < elBottom) {\n      this.$menu.scrollTop(menuScrollTop + (elBottom - menuHeight));\n    }\n  },\n  // ### public\n  close: function close() {\n    if (this.isOpen) {\n      this.isOpen = false;\n\n      this._removeCursor();\n\n      this._hide();\n\n      this.trigger('closed');\n    }\n  },\n  open: function open() {\n    if (!this.isOpen) {\n      this.isOpen = true;\n\n      if (!this.isEmpty) {\n        this._show();\n      }\n\n      this.trigger('opened');\n    }\n  },\n  setLanguageDirection: function setLanguageDirection(dir) {\n    this.$menu.css(dir === 'ltr' ? this.css.ltr : this.css.rtl);\n  },\n  moveCursorUp: function moveCursorUp() {\n    this._moveCursor(-1);\n  },\n  moveCursorDown: function moveCursorDown() {\n    this._moveCursor(+1);\n  },\n  getDatumForSuggestion: function getDatumForSuggestion($el) {\n    var datum = null;\n\n    if ($el.length) {\n      datum = {\n        raw: Dataset.extractDatum($el),\n        value: Dataset.extractValue($el),\n        datasetName: Dataset.extractDatasetName($el)\n      };\n    }\n\n    return datum;\n  },\n  getCurrentCursor: function getCurrentCursor() {\n    return this._getCursor().first();\n  },\n  getDatumForCursor: function getDatumForCursor() {\n    return this.getDatumForSuggestion(this._getCursor().first());\n  },\n  getDatumForTopSuggestion: function getDatumForTopSuggestion() {\n    return this.getDatumForSuggestion(this._getSuggestions().first());\n  },\n  cursorTopSuggestion: function cursorTopSuggestion() {\n    this._setCursor(this._getSuggestions().first(), false);\n  },\n  update: function update(query) {\n    _.each(this.datasets, updateDataset);\n\n    function updateDataset(dataset) {\n      dataset.update(query);\n    }\n  },\n  empty: function empty() {\n    _.each(this.datasets, clearDataset);\n\n    this.isEmpty = true;\n\n    function clearDataset(dataset) {\n      dataset.clear();\n    }\n  },\n  isVisible: function isVisible() {\n    return this.isOpen && !this.isEmpty;\n  },\n  destroy: function destroy() {\n    this.$menu.off('.aa');\n    this.$menu = null;\n\n    _.each(this.datasets, destroyDataset);\n\n    function destroyDataset(dataset) {\n      dataset.destroy();\n    }\n  }\n}); // helper functions\n// ----------------\n\n\nDropdown.Dataset = Dataset;\n\nfunction initializeDataset($menu, oDataset, cssClasses) {\n  return new Dropdown.Dataset(_.mixin({\n    $menu: $menu,\n    cssClasses: cssClasses\n  }, oDataset));\n}\n\nmodule.exports = Dropdown;","map":{"version":3,"sources":["/home/kali/Documents/cybersecurity/client/node_modules/autocomplete.js/src/autocomplete/dropdown.js"],"names":["_","require","DOM","EventEmitter","Dataset","css","Dropdown","o","that","onSuggestionClick","onSuggestionMouseEnter","onSuggestionMouseLeave","menu","error","isArray","datasets","isObject","isOpen","isEmpty","minLength","templates","appendTo","mixin","cssClasses","defaultClasses","prefix","formattedPrefix","formatPrefix","noPrefix","bind","_onSuggestionClick","_onSuggestionMouseEnter","_onSuggestionMouseLeave","cssClass","className","suggestion","$menu","element","on","$container","wrapper","header","templatify","prepend","empty","$empty","append","hide","map","oDataset","initializeDataset","each","dataset","root","getRoot","parent","length","onSync","_onRendered","footer","self","window","resize","_redraw","prototype","$e","trigger","currentTarget","elt","hasClass","cursor","_removeCursor","setTimeout","_setCursor","relatedTarget","closest","onRendered","e","query","every","isDatasetEmpty","_hide","html","show","_show","any","hasEmptyTemplate","redraw","_getSuggestions","getSuggestions","find","_getCursor","getCursor","first","setCursor","$el","updateInput","addClass","attr","removeCursor","removeClass","removeAttr","_moveCursor","moveCursor","increment","$suggestions","$oldCursor","newCursorIndex","$newCursor","index","eq","_ensureVisible","ensureVisible","elTop","elBottom","menuScrollTop","menuHeight","position","top","height","parseInt","scrollTop","close","open","setLanguageDirection","dir","ltr","rtl","moveCursorUp","moveCursorDown","getDatumForSuggestion","datum","raw","extractDatum","value","extractValue","datasetName","extractDatasetName","getCurrentCursor","getDatumForCursor","getDatumForTopSuggestion","cursorTopSuggestion","update","updateDataset","clearDataset","clear","isVisible","destroy","off","destroyDataset","module","exports"],"mappings":"AAAA;;AAEA,IAAIA,CAAC,GAAGC,OAAO,CAAC,oBAAD,CAAf;;AACA,IAAIC,GAAG,GAAGD,OAAO,CAAC,kBAAD,CAAjB;;AACA,IAAIE,YAAY,GAAGF,OAAO,CAAC,oBAAD,CAA1B;;AACA,IAAIG,OAAO,GAAGH,OAAO,CAAC,cAAD,CAArB;;AACA,IAAII,GAAG,GAAGJ,OAAO,CAAC,UAAD,CAAjB,C,CAEA;AACA;;;AAEA,SAASK,QAAT,CAAkBC,CAAlB,EAAqB;AACnB,MAAIC,IAAI,GAAG,IAAX;AACA,MAAIC,iBAAJ;AACA,MAAIC,sBAAJ;AACA,MAAIC,sBAAJ;AAEAJ,EAAAA,CAAC,GAAGA,CAAC,IAAI,EAAT;;AAEA,MAAI,CAACA,CAAC,CAACK,IAAP,EAAa;AACXZ,IAAAA,CAAC,CAACa,KAAF,CAAQ,kBAAR;AACD;;AAED,MAAI,CAACb,CAAC,CAACc,OAAF,CAAUP,CAAC,CAACQ,QAAZ,CAAD,IAA0B,CAACf,CAAC,CAACgB,QAAF,CAAWT,CAAC,CAACQ,QAAb,CAA/B,EAAuD;AACrDf,IAAAA,CAAC,CAACa,KAAF,CAAQ,6BAAR;AACD;;AACD,MAAI,CAACN,CAAC,CAACQ,QAAP,EAAiB;AACff,IAAAA,CAAC,CAACa,KAAF,CAAQ,sBAAR;AACD;;AAED,OAAKI,MAAL,GAAc,KAAd;AACA,OAAKC,OAAL,GAAe,IAAf;AACA,OAAKC,SAAL,GAAiBZ,CAAC,CAACY,SAAF,IAAe,CAAhC;AACA,OAAKC,SAAL,GAAiB,EAAjB;AACA,OAAKC,QAAL,GAAgBd,CAAC,CAACc,QAAF,IAAc,KAA9B;AACA,OAAKhB,GAAL,GAAWL,CAAC,CAACsB,KAAF,CAAQ,EAAR,EAAYjB,GAAZ,EAAiBE,CAAC,CAACc,QAAF,GAAahB,GAAG,CAACgB,QAAjB,GAA4B,EAA7C,CAAX;AACA,OAAKE,UAAL,GAAkBhB,CAAC,CAACgB,UAAF,GAAevB,CAAC,CAACsB,KAAF,CAAQ,EAAR,EAAYjB,GAAG,CAACmB,cAAhB,EAAgCjB,CAAC,CAACgB,UAAF,IAAgB,EAAhD,CAAjC;AACA,OAAKA,UAAL,CAAgBE,MAAhB,GACElB,CAAC,CAACgB,UAAF,CAAaG,eAAb,IAAgC1B,CAAC,CAAC2B,YAAF,CAAe,KAAKJ,UAAL,CAAgBE,MAA/B,EAAuC,KAAKF,UAAL,CAAgBK,QAAvD,CADlC,CA1BmB,CA6BnB;;AACAnB,EAAAA,iBAAiB,GAAGT,CAAC,CAAC6B,IAAF,CAAO,KAAKC,kBAAZ,EAAgC,IAAhC,CAApB;AACApB,EAAAA,sBAAsB,GAAGV,CAAC,CAAC6B,IAAF,CAAO,KAAKE,uBAAZ,EAAqC,IAArC,CAAzB;AACApB,EAAAA,sBAAsB,GAAGX,CAAC,CAAC6B,IAAF,CAAO,KAAKG,uBAAZ,EAAqC,IAArC,CAAzB;;AAEA,MAAIC,QAAQ,GAAGjC,CAAC,CAACkC,SAAF,CAAY,KAAKX,UAAL,CAAgBE,MAA5B,EAAoC,KAAKF,UAAL,CAAgBY,UAApD,CAAf;;AACA,OAAKC,KAAL,GAAalC,GAAG,CAACmC,OAAJ,CAAY9B,CAAC,CAACK,IAAd,EACV0B,EADU,CACP,eADO,EACUL,QADV,EACoBvB,sBADpB,EAEV4B,EAFU,CAEP,eAFO,EAEUL,QAFV,EAEoBtB,sBAFpB,EAGV2B,EAHU,CAGP,UAHO,EAGKL,QAHL,EAGexB,iBAHf,CAAb;AAKA,OAAK8B,UAAL,GAAkBhC,CAAC,CAACc,QAAF,GAAad,CAAC,CAACiC,OAAf,GAAyB,KAAKJ,KAAhD;;AAEA,MAAI7B,CAAC,CAACa,SAAF,IAAeb,CAAC,CAACa,SAAF,CAAYqB,MAA/B,EAAuC;AACrC,SAAKrB,SAAL,CAAeqB,MAAf,GAAwBzC,CAAC,CAAC0C,UAAF,CAAanC,CAAC,CAACa,SAAF,CAAYqB,MAAzB,CAAxB;AACA,SAAKL,KAAL,CAAWO,OAAX,CAAmB,KAAKvB,SAAL,CAAeqB,MAAf,EAAnB;AACD;;AAED,MAAIlC,CAAC,CAACa,SAAF,IAAeb,CAAC,CAACa,SAAF,CAAYwB,KAA/B,EAAsC;AACpC,SAAKxB,SAAL,CAAewB,KAAf,GAAuB5C,CAAC,CAAC0C,UAAF,CAAanC,CAAC,CAACa,SAAF,CAAYwB,KAAzB,CAAvB;AACA,SAAKC,MAAL,GAAc3C,GAAG,CAACmC,OAAJ,CAAY,iBACxBrC,CAAC,CAACkC,SAAF,CAAY,KAAKX,UAAL,CAAgBE,MAA5B,EAAoC,KAAKF,UAAL,CAAgBqB,KAApD,EAA2D,IAA3D,CADwB,GAC2C,IAD3C,GAExB,QAFY,CAAd;AAGA,SAAKR,KAAL,CAAWU,MAAX,CAAkB,KAAKD,MAAvB;AACA,SAAKA,MAAL,CAAYE,IAAZ;AACD;;AAED,OAAKhC,QAAL,GAAgBf,CAAC,CAACgD,GAAF,CAAMzC,CAAC,CAACQ,QAAR,EAAkB,UAASkC,QAAT,EAAmB;AACnD,WAAOC,iBAAiB,CAAC1C,IAAI,CAAC4B,KAAN,EAAaa,QAAb,EAAuB1C,CAAC,CAACgB,UAAzB,CAAxB;AACD,GAFe,CAAhB;;AAGAvB,EAAAA,CAAC,CAACmD,IAAF,CAAO,KAAKpC,QAAZ,EAAsB,UAASqC,OAAT,EAAkB;AACtC,QAAIC,IAAI,GAAGD,OAAO,CAACE,OAAR,EAAX;;AACA,QAAID,IAAI,IAAIA,IAAI,CAACE,MAAL,GAAcC,MAAd,KAAyB,CAArC,EAAwC;AACtChD,MAAAA,IAAI,CAAC4B,KAAL,CAAWU,MAAX,CAAkBO,IAAlB;AACD;;AACDD,IAAAA,OAAO,CAACK,MAAR,CAAe,UAAf,EAA2BjD,IAAI,CAACkD,WAAhC,EAA6ClD,IAA7C;AACD,GAND;;AAQA,MAAID,CAAC,CAACa,SAAF,IAAeb,CAAC,CAACa,SAAF,CAAYuC,MAA/B,EAAuC;AACrC,SAAKvC,SAAL,CAAeuC,MAAf,GAAwB3D,CAAC,CAAC0C,UAAF,CAAanC,CAAC,CAACa,SAAF,CAAYuC,MAAzB,CAAxB;AACA,SAAKvB,KAAL,CAAWU,MAAX,CAAkB,KAAK1B,SAAL,CAAeuC,MAAf,EAAlB;AACD;;AAED,MAAIC,IAAI,GAAG,IAAX;AACA1D,EAAAA,GAAG,CAACmC,OAAJ,CAAYwB,MAAZ,EAAoBC,MAApB,CAA2B,YAAW;AACpCF,IAAAA,IAAI,CAACG,OAAL;AACD,GAFD;AAGD,C,CAED;AACA;;;AAEA/D,CAAC,CAACsB,KAAF,CAAQhB,QAAQ,CAAC0D,SAAjB,EAA4B7D,YAA5B,EAA0C;AAExC;AAEA2B,EAAAA,kBAAkB,EAAE,SAASrB,iBAAT,CAA2BwD,EAA3B,EAA+B;AACjD,SAAKC,OAAL,CAAa,mBAAb,EAAkChE,GAAG,CAACmC,OAAJ,CAAY4B,EAAE,CAACE,aAAf,CAAlC;AACD,GANuC;AAQxCpC,EAAAA,uBAAuB,EAAE,SAASrB,sBAAT,CAAgCuD,EAAhC,EAAoC;AAC3D,QAAIG,GAAG,GAAGlE,GAAG,CAACmC,OAAJ,CAAY4B,EAAE,CAACE,aAAf,CAAV;;AACA,QAAIC,GAAG,CAACC,QAAJ,CAAarE,CAAC,CAACkC,SAAF,CAAY,KAAKX,UAAL,CAAgBE,MAA5B,EAAoC,KAAKF,UAAL,CAAgB+C,MAApD,EAA4D,IAA5D,CAAb,CAAJ,EAAqF;AACnF;AACA;AACA;AACD;;AACD,SAAKC,aAAL,GAP2D,CAS3D;AACA;AACA;AACA;;;AACA,QAAIpC,UAAU,GAAG,IAAjB;AACAqC,IAAAA,UAAU,CAAC,YAAW;AACpB;AACA;AACArC,MAAAA,UAAU,CAACsC,UAAX,CAAsBL,GAAtB,EAA2B,KAA3B;AACD,KAJS,EAIP,CAJO,CAAV;AAKD,GA3BuC;AA6BxCpC,EAAAA,uBAAuB,EAAE,SAASrB,sBAAT,CAAgCsD,EAAhC,EAAoC;AAC3D;AACA,QAAIA,EAAE,CAACS,aAAP,EAAsB;AACpB,UAAIN,GAAG,GAAGlE,GAAG,CAACmC,OAAJ,CAAY4B,EAAE,CAACS,aAAf,CAAV;;AACA,UAAIN,GAAG,CAACO,OAAJ,CAAY,MAAM3E,CAAC,CAACkC,SAAF,CAAY,KAAKX,UAAL,CAAgBE,MAA5B,EAAoC,KAAKF,UAAL,CAAgB+C,MAApD,EAA4D,IAA5D,CAAlB,EAAqFd,MAArF,GAA8F,CAAlG,EAAqG;AACnG;AACA;AACA;AACD;AACF;;AACD,SAAKe,aAAL;;AACA,SAAKL,OAAL,CAAa,eAAb;AACD,GAzCuC;AA2CxCR,EAAAA,WAAW,EAAE,SAASkB,UAAT,CAAoBC,CAApB,EAAuBC,KAAvB,EAA8B;AACzC,SAAK5D,OAAL,GAAelB,CAAC,CAAC+E,KAAF,CAAQ,KAAKhE,QAAb,EAAuBiE,cAAvB,CAAf;;AAEA,QAAI,KAAK9D,OAAT,EAAkB;AAChB,UAAI4D,KAAK,CAACtB,MAAN,IAAgB,KAAKrC,SAAzB,EAAoC;AAClC,aAAK+C,OAAL,CAAa,OAAb;AACD;;AAED,UAAI,KAAKrB,MAAT,EAAiB;AACf,YAAIiC,KAAK,CAACtB,MAAN,GAAe,KAAKrC,SAAxB,EAAmC;AACjC,eAAK8D,KAAL;AACD,SAFD,MAEO;AACL,cAAIC,IAAI,GAAG,KAAK9D,SAAL,CAAewB,KAAf,CAAqB;AAC9BkC,YAAAA,KAAK,EAAE,KAAK/D,QAAL,CAAc,CAAd,KAAoB,KAAKA,QAAL,CAAc,CAAd,EAAiB+D;AADd,WAArB,CAAX;AAGA,eAAKjC,MAAL,CAAYqC,IAAZ,CAAiBA,IAAjB;AACA,eAAKrC,MAAL,CAAYsC,IAAZ;;AACA,eAAKC,KAAL;AACD;AACF,OAXD,MAWO,IAAIpF,CAAC,CAACqF,GAAF,CAAM,KAAKtE,QAAX,EAAqBuE,gBAArB,CAAJ,EAA4C;AACjD,YAAIR,KAAK,CAACtB,MAAN,GAAe,KAAKrC,SAAxB,EAAmC;AACjC,eAAK8D,KAAL;AACD,SAFD,MAEO;AACL,eAAKG,KAAL;AACD;AACF,OANM,MAMA;AACL,aAAKH,KAAL;AACD;AACF,KAzBD,MAyBO,IAAI,KAAKhE,MAAT,EAAiB;AACtB,UAAI,KAAK4B,MAAT,EAAiB;AACf,aAAKA,MAAL,CAAYD,KAAZ;AACA,aAAKC,MAAL,CAAYE,IAAZ;AACD;;AAED,UAAI+B,KAAK,CAACtB,MAAN,IAAgB,KAAKrC,SAAzB,EAAoC;AAClC,aAAKiE,KAAL;AACD,OAFD,MAEO;AACL,aAAKH,KAAL;AACD;AACF;;AAED,SAAKf,OAAL,CAAa,iBAAb;;AAEA,aAASc,cAAT,CAAwB5B,OAAxB,EAAiC;AAC/B,aAAOA,OAAO,CAAClC,OAAR,EAAP;AACD;;AAED,aAASoE,gBAAT,CAA0BlC,OAA1B,EAAmC;AACjC,aAAOA,OAAO,CAAChC,SAAR,IAAqBgC,OAAO,CAAChC,SAAR,CAAkBwB,KAA9C;AACD;AACF,GA7FuC;AA+FxCqC,EAAAA,KAAK,EAAE,YAAW;AAChB,SAAK1C,UAAL,CAAgBQ,IAAhB;AACD,GAjGuC;AAmGxCqC,EAAAA,KAAK,EAAE,YAAW;AAChB;AACA;AACA,SAAK7C,UAAL,CAAgBlC,GAAhB,CAAoB,SAApB,EAA+B,OAA/B;;AAEA,SAAK0D,OAAL;;AAEA,SAAKG,OAAL,CAAa,OAAb;AACD,GA3GuC;AA6GxCH,EAAAA,OAAO,EAAE,SAASwB,MAAT,GAAkB;AACzB,QAAI,CAAC,KAAKtE,MAAN,IAAgB,CAAC,KAAKI,QAA1B,EAAoC;AAEpC,SAAK6C,OAAL,CAAa,SAAb;AACD,GAjHuC;AAmHxCsB,EAAAA,eAAe,EAAE,SAASC,cAAT,GAA0B;AACzC,WAAO,KAAKrD,KAAL,CAAWsD,IAAX,CAAgB1F,CAAC,CAACkC,SAAF,CAAY,KAAKX,UAAL,CAAgBE,MAA5B,EAAoC,KAAKF,UAAL,CAAgBY,UAApD,CAAhB,CAAP;AACD,GArHuC;AAuHxCwD,EAAAA,UAAU,EAAE,SAASC,SAAT,GAAqB;AAC/B,WAAO,KAAKxD,KAAL,CAAWsD,IAAX,CAAgB1F,CAAC,CAACkC,SAAF,CAAY,KAAKX,UAAL,CAAgBE,MAA5B,EAAoC,KAAKF,UAAL,CAAgB+C,MAApD,CAAhB,EAA6EuB,KAA7E,EAAP;AACD,GAzHuC;AA2HxCpB,EAAAA,UAAU,EAAE,SAASqB,SAAT,CAAmBC,GAAnB,EAAwBC,WAAxB,EAAqC;AAC/CD,IAAAA,GAAG,CAACF,KAAJ,GACGI,QADH,CACYjG,CAAC,CAACkC,SAAF,CAAY,KAAKX,UAAL,CAAgBE,MAA5B,EAAoC,KAAKF,UAAL,CAAgB+C,MAApD,EAA4D,IAA5D,CADZ,EAEG4B,IAFH,CAEQ,eAFR,EAEyB,MAFzB;AAGA,SAAKhC,OAAL,CAAa,aAAb,EAA4B8B,WAA5B;AACD,GAhIuC;AAkIxCzB,EAAAA,aAAa,EAAE,SAAS4B,YAAT,GAAwB;AACrC,SAAKR,UAAL,GACGS,WADH,CACepG,CAAC,CAACkC,SAAF,CAAY,KAAKX,UAAL,CAAgBE,MAA5B,EAAoC,KAAKF,UAAL,CAAgB+C,MAApD,EAA4D,IAA5D,CADf,EAEG+B,UAFH,CAEc,eAFd;AAGD,GAtIuC;AAwIxCC,EAAAA,WAAW,EAAE,SAASC,UAAT,CAAoBC,SAApB,EAA+B;AAC1C,QAAIC,YAAJ;AACA,QAAIC,UAAJ;AACA,QAAIC,cAAJ;AACA,QAAIC,UAAJ;;AAEA,QAAI,CAAC,KAAK3F,MAAV,EAAkB;AAChB;AACD;;AAEDyF,IAAAA,UAAU,GAAG,KAAKf,UAAL,EAAb;AACAc,IAAAA,YAAY,GAAG,KAAKjB,eAAL,EAAf;;AAEA,SAAKjB,aAAL,GAb0C,CAe1C;;;AACAoC,IAAAA,cAAc,GAAGF,YAAY,CAACI,KAAb,CAAmBH,UAAnB,IAAiCF,SAAlD;AACAG,IAAAA,cAAc,GAAG,CAACA,cAAc,GAAG,CAAlB,KAAwBF,YAAY,CAACjD,MAAb,GAAsB,CAA9C,IAAmD,CAApE;;AAEA,QAAImD,cAAc,KAAK,CAAC,CAAxB,EAA2B;AACzB,WAAKzC,OAAL,CAAa,eAAb;AAEA;AACD,KAJD,MAIO,IAAIyC,cAAc,GAAG,CAAC,CAAtB,EAAyB;AAC9BA,MAAAA,cAAc,GAAGF,YAAY,CAACjD,MAAb,GAAsB,CAAvC;AACD;;AAED,SAAKiB,UAAL,CAAgBmC,UAAU,GAAGH,YAAY,CAACK,EAAb,CAAgBH,cAAhB,CAA7B,EAA8D,IAA9D,EA3B0C,CA6B1C;AACA;;;AACA,SAAKI,cAAL,CAAoBH,UAApB;AACD,GAxKuC;AA0KxCG,EAAAA,cAAc,EAAE,SAASC,aAAT,CAAuBjB,GAAvB,EAA4B;AAC1C,QAAIkB,KAAJ;AACA,QAAIC,QAAJ;AACA,QAAIC,aAAJ;AACA,QAAIC,UAAJ;AAEAH,IAAAA,KAAK,GAAGlB,GAAG,CAACsB,QAAJ,GAAeC,GAAvB;AACAJ,IAAAA,QAAQ,GAAGD,KAAK,GAAGlB,GAAG,CAACwB,MAAJ,EAAR,GACTC,QAAQ,CAACzB,GAAG,CAAC1F,GAAJ,CAAQ,YAAR,CAAD,EAAwB,EAAxB,CADC,GAETmH,QAAQ,CAACzB,GAAG,CAAC1F,GAAJ,CAAQ,eAAR,CAAD,EAA2B,EAA3B,CAFV;AAGA8G,IAAAA,aAAa,GAAG,KAAK/E,KAAL,CAAWqF,SAAX,EAAhB;AACAL,IAAAA,UAAU,GAAG,KAAKhF,KAAL,CAAWmF,MAAX,KACXC,QAAQ,CAAC,KAAKpF,KAAL,CAAW/B,GAAX,CAAe,aAAf,CAAD,EAAgC,EAAhC,CADG,GAEXmH,QAAQ,CAAC,KAAKpF,KAAL,CAAW/B,GAAX,CAAe,gBAAf,CAAD,EAAmC,EAAnC,CAFV;;AAIA,QAAI4G,KAAK,GAAG,CAAZ,EAAe;AACb,WAAK7E,KAAL,CAAWqF,SAAX,CAAqBN,aAAa,GAAGF,KAArC;AACD,KAFD,MAEO,IAAIG,UAAU,GAAGF,QAAjB,EAA2B;AAChC,WAAK9E,KAAL,CAAWqF,SAAX,CAAqBN,aAAa,IAAID,QAAQ,GAAGE,UAAf,CAAlC;AACD;AACF,GA9LuC;AAgMxC;AAEAM,EAAAA,KAAK,EAAE,SAASA,KAAT,GAAiB;AACtB,QAAI,KAAKzG,MAAT,EAAiB;AACf,WAAKA,MAAL,GAAc,KAAd;;AAEA,WAAKsD,aAAL;;AACA,WAAKU,KAAL;;AAEA,WAAKf,OAAL,CAAa,QAAb;AACD;AACF,GA3MuC;AA6MxCyD,EAAAA,IAAI,EAAE,SAASA,IAAT,GAAgB;AACpB,QAAI,CAAC,KAAK1G,MAAV,EAAkB;AAChB,WAAKA,MAAL,GAAc,IAAd;;AAEA,UAAI,CAAC,KAAKC,OAAV,EAAmB;AACjB,aAAKkE,KAAL;AACD;;AAED,WAAKlB,OAAL,CAAa,QAAb;AACD;AACF,GAvNuC;AAyNxC0D,EAAAA,oBAAoB,EAAE,SAASA,oBAAT,CAA8BC,GAA9B,EAAmC;AACvD,SAAKzF,KAAL,CAAW/B,GAAX,CAAewH,GAAG,KAAK,KAAR,GAAgB,KAAKxH,GAAL,CAASyH,GAAzB,GAA+B,KAAKzH,GAAL,CAAS0H,GAAvD;AACD,GA3NuC;AA6NxCC,EAAAA,YAAY,EAAE,SAASA,YAAT,GAAwB;AACpC,SAAK1B,WAAL,CAAiB,CAAC,CAAlB;AACD,GA/NuC;AAiOxC2B,EAAAA,cAAc,EAAE,SAASA,cAAT,GAA0B;AACxC,SAAK3B,WAAL,CAAiB,CAAC,CAAlB;AACD,GAnOuC;AAqOxC4B,EAAAA,qBAAqB,EAAE,SAASA,qBAAT,CAA+BnC,GAA/B,EAAoC;AACzD,QAAIoC,KAAK,GAAG,IAAZ;;AAEA,QAAIpC,GAAG,CAACvC,MAAR,EAAgB;AACd2E,MAAAA,KAAK,GAAG;AACNC,QAAAA,GAAG,EAAEhI,OAAO,CAACiI,YAAR,CAAqBtC,GAArB,CADC;AAENuC,QAAAA,KAAK,EAAElI,OAAO,CAACmI,YAAR,CAAqBxC,GAArB,CAFD;AAGNyC,QAAAA,WAAW,EAAEpI,OAAO,CAACqI,kBAAR,CAA2B1C,GAA3B;AAHP,OAAR;AAKD;;AAED,WAAOoC,KAAP;AACD,GAjPuC;AAmPxCO,EAAAA,gBAAgB,EAAE,SAASA,gBAAT,GAA4B;AAC5C,WAAO,KAAK/C,UAAL,GAAkBE,KAAlB,EAAP;AACD,GArPuC;AAuPxC8C,EAAAA,iBAAiB,EAAE,SAASA,iBAAT,GAA6B;AAC9C,WAAO,KAAKT,qBAAL,CAA2B,KAAKvC,UAAL,GAAkBE,KAAlB,EAA3B,CAAP;AACD,GAzPuC;AA2PxC+C,EAAAA,wBAAwB,EAAE,SAASA,wBAAT,GAAoC;AAC5D,WAAO,KAAKV,qBAAL,CAA2B,KAAK1C,eAAL,GAAuBK,KAAvB,EAA3B,CAAP;AACD,GA7PuC;AA+PxCgD,EAAAA,mBAAmB,EAAE,SAASA,mBAAT,GAA+B;AAClD,SAAKpE,UAAL,CAAgB,KAAKe,eAAL,GAAuBK,KAAvB,EAAhB,EAAgD,KAAhD;AACD,GAjQuC;AAmQxCiD,EAAAA,MAAM,EAAE,SAASA,MAAT,CAAgBhE,KAAhB,EAAuB;AAC7B9E,IAAAA,CAAC,CAACmD,IAAF,CAAO,KAAKpC,QAAZ,EAAsBgI,aAAtB;;AAEA,aAASA,aAAT,CAAuB3F,OAAvB,EAAgC;AAC9BA,MAAAA,OAAO,CAAC0F,MAAR,CAAehE,KAAf;AACD;AACF,GAzQuC;AA2QxClC,EAAAA,KAAK,EAAE,SAASA,KAAT,GAAiB;AACtB5C,IAAAA,CAAC,CAACmD,IAAF,CAAO,KAAKpC,QAAZ,EAAsBiI,YAAtB;;AACA,SAAK9H,OAAL,GAAe,IAAf;;AAEA,aAAS8H,YAAT,CAAsB5F,OAAtB,EAA+B;AAC7BA,MAAAA,OAAO,CAAC6F,KAAR;AACD;AACF,GAlRuC;AAoRxCC,EAAAA,SAAS,EAAE,SAASA,SAAT,GAAqB;AAC9B,WAAO,KAAKjI,MAAL,IAAe,CAAC,KAAKC,OAA5B;AACD,GAtRuC;AAwRxCiI,EAAAA,OAAO,EAAE,SAASA,OAAT,GAAmB;AAC1B,SAAK/G,KAAL,CAAWgH,GAAX,CAAe,KAAf;AAEA,SAAKhH,KAAL,GAAa,IAAb;;AAEApC,IAAAA,CAAC,CAACmD,IAAF,CAAO,KAAKpC,QAAZ,EAAsBsI,cAAtB;;AAEA,aAASA,cAAT,CAAwBjG,OAAxB,EAAiC;AAC/BA,MAAAA,OAAO,CAAC+F,OAAR;AACD;AACF;AAlSuC,CAA1C,E,CAqSA;AACA;;;AACA7I,QAAQ,CAACF,OAAT,GAAmBA,OAAnB;;AAEA,SAAS8C,iBAAT,CAA2Bd,KAA3B,EAAkCa,QAAlC,EAA4C1B,UAA5C,EAAwD;AACtD,SAAO,IAAIjB,QAAQ,CAACF,OAAb,CAAqBJ,CAAC,CAACsB,KAAF,CAAQ;AAACc,IAAAA,KAAK,EAAEA,KAAR;AAAeb,IAAAA,UAAU,EAAEA;AAA3B,GAAR,EAAgD0B,QAAhD,CAArB,CAAP;AACD;;AAEDqG,MAAM,CAACC,OAAP,GAAiBjJ,QAAjB","sourcesContent":["'use strict';\n\nvar _ = require('../common/utils.js');\nvar DOM = require('../common/dom.js');\nvar EventEmitter = require('./event_emitter.js');\nvar Dataset = require('./dataset.js');\nvar css = require('./css.js');\n\n// constructor\n// -----------\n\nfunction Dropdown(o) {\n  var that = this;\n  var onSuggestionClick;\n  var onSuggestionMouseEnter;\n  var onSuggestionMouseLeave;\n\n  o = o || {};\n\n  if (!o.menu) {\n    _.error('menu is required');\n  }\n\n  if (!_.isArray(o.datasets) && !_.isObject(o.datasets)) {\n    _.error('1 or more datasets required');\n  }\n  if (!o.datasets) {\n    _.error('datasets is required');\n  }\n\n  this.isOpen = false;\n  this.isEmpty = true;\n  this.minLength = o.minLength || 0;\n  this.templates = {};\n  this.appendTo = o.appendTo || false;\n  this.css = _.mixin({}, css, o.appendTo ? css.appendTo : {});\n  this.cssClasses = o.cssClasses = _.mixin({}, css.defaultClasses, o.cssClasses || {});\n  this.cssClasses.prefix =\n    o.cssClasses.formattedPrefix || _.formatPrefix(this.cssClasses.prefix, this.cssClasses.noPrefix);\n\n  // bound functions\n  onSuggestionClick = _.bind(this._onSuggestionClick, this);\n  onSuggestionMouseEnter = _.bind(this._onSuggestionMouseEnter, this);\n  onSuggestionMouseLeave = _.bind(this._onSuggestionMouseLeave, this);\n\n  var cssClass = _.className(this.cssClasses.prefix, this.cssClasses.suggestion);\n  this.$menu = DOM.element(o.menu)\n    .on('mouseenter.aa', cssClass, onSuggestionMouseEnter)\n    .on('mouseleave.aa', cssClass, onSuggestionMouseLeave)\n    .on('click.aa', cssClass, onSuggestionClick);\n\n  this.$container = o.appendTo ? o.wrapper : this.$menu;\n\n  if (o.templates && o.templates.header) {\n    this.templates.header = _.templatify(o.templates.header);\n    this.$menu.prepend(this.templates.header());\n  }\n\n  if (o.templates && o.templates.empty) {\n    this.templates.empty = _.templatify(o.templates.empty);\n    this.$empty = DOM.element('<div class=\"' +\n      _.className(this.cssClasses.prefix, this.cssClasses.empty, true) + '\">' +\n      '</div>');\n    this.$menu.append(this.$empty);\n    this.$empty.hide();\n  }\n\n  this.datasets = _.map(o.datasets, function(oDataset) {\n    return initializeDataset(that.$menu, oDataset, o.cssClasses);\n  });\n  _.each(this.datasets, function(dataset) {\n    var root = dataset.getRoot();\n    if (root && root.parent().length === 0) {\n      that.$menu.append(root);\n    }\n    dataset.onSync('rendered', that._onRendered, that);\n  });\n\n  if (o.templates && o.templates.footer) {\n    this.templates.footer = _.templatify(o.templates.footer);\n    this.$menu.append(this.templates.footer());\n  }\n\n  var self = this;\n  DOM.element(window).resize(function() {\n    self._redraw();\n  });\n}\n\n// instance methods\n// ----------------\n\n_.mixin(Dropdown.prototype, EventEmitter, {\n\n  // ### private\n\n  _onSuggestionClick: function onSuggestionClick($e) {\n    this.trigger('suggestionClicked', DOM.element($e.currentTarget));\n  },\n\n  _onSuggestionMouseEnter: function onSuggestionMouseEnter($e) {\n    var elt = DOM.element($e.currentTarget);\n    if (elt.hasClass(_.className(this.cssClasses.prefix, this.cssClasses.cursor, true))) {\n      // we're already on the cursor\n      // => we're probably entering it again after leaving it for a nested div\n      return;\n    }\n    this._removeCursor();\n\n    // Fixes iOS double tap behaviour, by modifying the DOM right before the\n    // native href clicks happens, iOS will requires another tap to follow\n    // a suggestion that has an <a href> element inside\n    // https://www.google.com/search?q=ios+double+tap+bug+href\n    var suggestion = this;\n    setTimeout(function() {\n      // this exact line, when inside the main loop, will trigger a double tap bug\n      // on iOS devices\n      suggestion._setCursor(elt, false);\n    }, 0);\n  },\n\n  _onSuggestionMouseLeave: function onSuggestionMouseLeave($e) {\n    // $e.relatedTarget is the `EventTarget` the pointing device entered to\n    if ($e.relatedTarget) {\n      var elt = DOM.element($e.relatedTarget);\n      if (elt.closest('.' + _.className(this.cssClasses.prefix, this.cssClasses.cursor, true)).length > 0) {\n        // our father is a cursor\n        // => it means we're just leaving the suggestion for a nested div\n        return;\n      }\n    }\n    this._removeCursor();\n    this.trigger('cursorRemoved');\n  },\n\n  _onRendered: function onRendered(e, query) {\n    this.isEmpty = _.every(this.datasets, isDatasetEmpty);\n\n    if (this.isEmpty) {\n      if (query.length >= this.minLength) {\n        this.trigger('empty');\n      }\n\n      if (this.$empty) {\n        if (query.length < this.minLength) {\n          this._hide();\n        } else {\n          var html = this.templates.empty({\n            query: this.datasets[0] && this.datasets[0].query\n          });\n          this.$empty.html(html);\n          this.$empty.show();\n          this._show();\n        }\n      } else if (_.any(this.datasets, hasEmptyTemplate)) {\n        if (query.length < this.minLength) {\n          this._hide();\n        } else {\n          this._show();\n        }\n      } else {\n        this._hide();\n      }\n    } else if (this.isOpen) {\n      if (this.$empty) {\n        this.$empty.empty();\n        this.$empty.hide();\n      }\n\n      if (query.length >= this.minLength) {\n        this._show();\n      } else {\n        this._hide();\n      }\n    }\n\n    this.trigger('datasetRendered');\n\n    function isDatasetEmpty(dataset) {\n      return dataset.isEmpty();\n    }\n\n    function hasEmptyTemplate(dataset) {\n      return dataset.templates && dataset.templates.empty;\n    }\n  },\n\n  _hide: function() {\n    this.$container.hide();\n  },\n\n  _show: function() {\n    // can't use jQuery#show because $menu is a span element we want\n    // display: block; not dislay: inline;\n    this.$container.css('display', 'block');\n\n    this._redraw();\n\n    this.trigger('shown');\n  },\n\n  _redraw: function redraw() {\n    if (!this.isOpen || !this.appendTo) return;\n\n    this.trigger('redrawn');\n  },\n\n  _getSuggestions: function getSuggestions() {\n    return this.$menu.find(_.className(this.cssClasses.prefix, this.cssClasses.suggestion));\n  },\n\n  _getCursor: function getCursor() {\n    return this.$menu.find(_.className(this.cssClasses.prefix, this.cssClasses.cursor)).first();\n  },\n\n  _setCursor: function setCursor($el, updateInput) {\n    $el.first()\n      .addClass(_.className(this.cssClasses.prefix, this.cssClasses.cursor, true))\n      .attr('aria-selected', 'true');\n    this.trigger('cursorMoved', updateInput);\n  },\n\n  _removeCursor: function removeCursor() {\n    this._getCursor()\n      .removeClass(_.className(this.cssClasses.prefix, this.cssClasses.cursor, true))\n      .removeAttr('aria-selected');\n  },\n\n  _moveCursor: function moveCursor(increment) {\n    var $suggestions;\n    var $oldCursor;\n    var newCursorIndex;\n    var $newCursor;\n\n    if (!this.isOpen) {\n      return;\n    }\n\n    $oldCursor = this._getCursor();\n    $suggestions = this._getSuggestions();\n\n    this._removeCursor();\n\n    // shifting before and after modulo to deal with -1 index\n    newCursorIndex = $suggestions.index($oldCursor) + increment;\n    newCursorIndex = (newCursorIndex + 1) % ($suggestions.length + 1) - 1;\n\n    if (newCursorIndex === -1) {\n      this.trigger('cursorRemoved');\n\n      return;\n    } else if (newCursorIndex < -1) {\n      newCursorIndex = $suggestions.length - 1;\n    }\n\n    this._setCursor($newCursor = $suggestions.eq(newCursorIndex), true);\n\n    // in the case of scrollable overflow\n    // make sure the cursor is visible in the menu\n    this._ensureVisible($newCursor);\n  },\n\n  _ensureVisible: function ensureVisible($el) {\n    var elTop;\n    var elBottom;\n    var menuScrollTop;\n    var menuHeight;\n\n    elTop = $el.position().top;\n    elBottom = elTop + $el.height() +\n      parseInt($el.css('margin-top'), 10) +\n      parseInt($el.css('margin-bottom'), 10);\n    menuScrollTop = this.$menu.scrollTop();\n    menuHeight = this.$menu.height() +\n      parseInt(this.$menu.css('padding-top'), 10) +\n      parseInt(this.$menu.css('padding-bottom'), 10);\n\n    if (elTop < 0) {\n      this.$menu.scrollTop(menuScrollTop + elTop);\n    } else if (menuHeight < elBottom) {\n      this.$menu.scrollTop(menuScrollTop + (elBottom - menuHeight));\n    }\n  },\n\n  // ### public\n\n  close: function close() {\n    if (this.isOpen) {\n      this.isOpen = false;\n\n      this._removeCursor();\n      this._hide();\n\n      this.trigger('closed');\n    }\n  },\n\n  open: function open() {\n    if (!this.isOpen) {\n      this.isOpen = true;\n\n      if (!this.isEmpty) {\n        this._show();\n      }\n\n      this.trigger('opened');\n    }\n  },\n\n  setLanguageDirection: function setLanguageDirection(dir) {\n    this.$menu.css(dir === 'ltr' ? this.css.ltr : this.css.rtl);\n  },\n\n  moveCursorUp: function moveCursorUp() {\n    this._moveCursor(-1);\n  },\n\n  moveCursorDown: function moveCursorDown() {\n    this._moveCursor(+1);\n  },\n\n  getDatumForSuggestion: function getDatumForSuggestion($el) {\n    var datum = null;\n\n    if ($el.length) {\n      datum = {\n        raw: Dataset.extractDatum($el),\n        value: Dataset.extractValue($el),\n        datasetName: Dataset.extractDatasetName($el)\n      };\n    }\n\n    return datum;\n  },\n\n  getCurrentCursor: function getCurrentCursor() {\n    return this._getCursor().first();\n  },\n\n  getDatumForCursor: function getDatumForCursor() {\n    return this.getDatumForSuggestion(this._getCursor().first());\n  },\n\n  getDatumForTopSuggestion: function getDatumForTopSuggestion() {\n    return this.getDatumForSuggestion(this._getSuggestions().first());\n  },\n\n  cursorTopSuggestion: function cursorTopSuggestion() {\n    this._setCursor(this._getSuggestions().first(), false);\n  },\n\n  update: function update(query) {\n    _.each(this.datasets, updateDataset);\n\n    function updateDataset(dataset) {\n      dataset.update(query);\n    }\n  },\n\n  empty: function empty() {\n    _.each(this.datasets, clearDataset);\n    this.isEmpty = true;\n\n    function clearDataset(dataset) {\n      dataset.clear();\n    }\n  },\n\n  isVisible: function isVisible() {\n    return this.isOpen && !this.isEmpty;\n  },\n\n  destroy: function destroy() {\n    this.$menu.off('.aa');\n\n    this.$menu = null;\n\n    _.each(this.datasets, destroyDataset);\n\n    function destroyDataset(dataset) {\n      dataset.destroy();\n    }\n  }\n});\n\n// helper functions\n// ----------------\nDropdown.Dataset = Dataset;\n\nfunction initializeDataset($menu, oDataset, cssClasses) {\n  return new Dropdown.Dataset(_.mixin({$menu: $menu, cssClasses: cssClasses}, oDataset));\n}\n\nmodule.exports = Dropdown;\n"]},"metadata":{},"sourceType":"script"}