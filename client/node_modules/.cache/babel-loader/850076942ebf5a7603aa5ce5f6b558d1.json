{"ast":null,"code":"'use strict';\n\nvar datasetKey = 'aaDataset';\nvar valueKey = 'aaValue';\nvar datumKey = 'aaDatum';\n\nvar _ = require('../common/utils.js');\n\nvar DOM = require('../common/dom.js');\n\nvar html = require('./html.js');\n\nvar css = require('./css.js');\n\nvar EventEmitter = require('./event_emitter.js'); // constructor\n// -----------\n\n\nfunction Dataset(o) {\n  o = o || {};\n  o.templates = o.templates || {};\n\n  if (!o.source) {\n    _.error('missing source');\n  }\n\n  if (o.name && !isValidName(o.name)) {\n    _.error('invalid dataset name: ' + o.name);\n  } // tracks the last query the dataset was updated for\n\n\n  this.query = null;\n  this._isEmpty = true;\n  this.highlight = !!o.highlight;\n  this.name = typeof o.name === 'undefined' || o.name === null ? _.getUniqueId() : o.name;\n  this.source = o.source;\n  this.displayFn = getDisplayFn(o.display || o.displayKey);\n  this.debounce = o.debounce;\n  this.cache = o.cache !== false;\n  this.templates = getTemplates(o.templates, this.displayFn);\n  this.css = _.mixin({}, css, o.appendTo ? css.appendTo : {});\n  this.cssClasses = o.cssClasses = _.mixin({}, css.defaultClasses, o.cssClasses || {});\n  this.cssClasses.prefix = o.cssClasses.formattedPrefix || _.formatPrefix(this.cssClasses.prefix, this.cssClasses.noPrefix);\n\n  var clazz = _.className(this.cssClasses.prefix, this.cssClasses.dataset);\n\n  this.$el = o.$menu && o.$menu.find(clazz + '-' + this.name).length > 0 ? DOM.element(o.$menu.find(clazz + '-' + this.name)[0]) : DOM.element(html.dataset.replace('%CLASS%', this.name).replace('%PREFIX%', this.cssClasses.prefix).replace('%DATASET%', this.cssClasses.dataset));\n  this.$menu = o.$menu;\n  this.clearCachedSuggestions();\n} // static methods\n// --------------\n\n\nDataset.extractDatasetName = function extractDatasetName(el) {\n  return DOM.element(el).data(datasetKey);\n};\n\nDataset.extractValue = function extractValue(el) {\n  return DOM.element(el).data(valueKey);\n};\n\nDataset.extractDatum = function extractDatum(el) {\n  var datum = DOM.element(el).data(datumKey);\n\n  if (typeof datum === 'string') {\n    // Zepto has an automatic deserialization of the\n    // JSON encoded data attribute\n    datum = JSON.parse(datum);\n  }\n\n  return datum;\n}; // instance methods\n// ----------------\n\n\n_.mixin(Dataset.prototype, EventEmitter, {\n  // ### private\n  _render: function render(query, suggestions) {\n    if (!this.$el) {\n      return;\n    }\n\n    var that = this;\n    var hasSuggestions;\n    var renderArgs = [].slice.call(arguments, 2);\n    this.$el.empty();\n    hasSuggestions = suggestions && suggestions.length;\n    this._isEmpty = !hasSuggestions;\n\n    if (!hasSuggestions && this.templates.empty) {\n      this.$el.html(getEmptyHtml.apply(this, renderArgs)).prepend(that.templates.header ? getHeaderHtml.apply(this, renderArgs) : null).append(that.templates.footer ? getFooterHtml.apply(this, renderArgs) : null);\n    } else if (hasSuggestions) {\n      this.$el.html(getSuggestionsHtml.apply(this, renderArgs)).prepend(that.templates.header ? getHeaderHtml.apply(this, renderArgs) : null).append(that.templates.footer ? getFooterHtml.apply(this, renderArgs) : null);\n    } else if (suggestions && !Array.isArray(suggestions)) {\n      throw new TypeError('suggestions must be an array');\n    }\n\n    if (this.$menu) {\n      this.$menu.addClass(this.cssClasses.prefix + (hasSuggestions ? 'with' : 'without') + '-' + this.name).removeClass(this.cssClasses.prefix + (hasSuggestions ? 'without' : 'with') + '-' + this.name);\n    }\n\n    this.trigger('rendered', query);\n\n    function getEmptyHtml() {\n      var args = [].slice.call(arguments, 0);\n      args = [{\n        query: query,\n        isEmpty: true\n      }].concat(args);\n      return that.templates.empty.apply(this, args);\n    }\n\n    function getSuggestionsHtml() {\n      var args = [].slice.call(arguments, 0);\n      var $suggestions;\n      var nodes;\n      var self = this;\n      var suggestionsHtml = html.suggestions.replace('%PREFIX%', this.cssClasses.prefix).replace('%SUGGESTIONS%', this.cssClasses.suggestions);\n      $suggestions = DOM.element(suggestionsHtml).css(this.css.suggestions); // jQuery#append doesn't support arrays as the first argument\n      // until version 1.8, see http://bugs.jquery.com/ticket/11231\n\n      nodes = _.map(suggestions, getSuggestionNode);\n      $suggestions.append.apply($suggestions, nodes);\n      return $suggestions;\n\n      function getSuggestionNode(suggestion) {\n        var $el;\n        var suggestionHtml = html.suggestion.replace('%PREFIX%', self.cssClasses.prefix).replace('%SUGGESTION%', self.cssClasses.suggestion);\n        $el = DOM.element(suggestionHtml).attr({\n          role: 'option',\n          id: ['option', Math.floor(Math.random() * 100000000)].join('-')\n        }).append(that.templates.suggestion.apply(this, [suggestion].concat(args)));\n        $el.data(datasetKey, that.name);\n        $el.data(valueKey, that.displayFn(suggestion) || undefined); // this led to undefined return value\n\n        $el.data(datumKey, JSON.stringify(suggestion));\n        $el.children().each(function () {\n          DOM.element(this).css(self.css.suggestionChild);\n        });\n        return $el;\n      }\n    }\n\n    function getHeaderHtml() {\n      var args = [].slice.call(arguments, 0);\n      args = [{\n        query: query,\n        isEmpty: !hasSuggestions\n      }].concat(args);\n      return that.templates.header.apply(this, args);\n    }\n\n    function getFooterHtml() {\n      var args = [].slice.call(arguments, 0);\n      args = [{\n        query: query,\n        isEmpty: !hasSuggestions\n      }].concat(args);\n      return that.templates.footer.apply(this, args);\n    }\n  },\n  // ### public\n  getRoot: function getRoot() {\n    return this.$el;\n  },\n  update: function update(query) {\n    function handleSuggestions(suggestions) {\n      // if the update has been canceled or if the query has changed\n      // do not render the suggestions as they've become outdated\n      if (!this.canceled && query === this.query) {\n        // concat all the other arguments that could have been passed\n        // to the render function, and forward them to _render\n        var extraArgs = [].slice.call(arguments, 1);\n        this.cacheSuggestions(query, suggestions, extraArgs);\n\n        this._render.apply(this, [query, suggestions].concat(extraArgs));\n      }\n    }\n\n    this.query = query;\n    this.canceled = false;\n\n    if (this.shouldFetchFromCache(query)) {\n      handleSuggestions.apply(this, [this.cachedSuggestions].concat(this.cachedRenderExtraArgs));\n    } else {\n      var that = this;\n\n      var execSource = function () {\n        // When the call is debounced the condition avoid to do a useless\n        // request with the last character when the input has been cleared\n        if (!that.canceled) {\n          that.source(query, handleSuggestions.bind(that));\n        }\n      };\n\n      if (this.debounce) {\n        var later = function () {\n          that.debounceTimeout = null;\n          execSource();\n        };\n\n        clearTimeout(this.debounceTimeout);\n        this.debounceTimeout = setTimeout(later, this.debounce);\n      } else {\n        execSource();\n      }\n    }\n  },\n  cacheSuggestions: function cacheSuggestions(query, suggestions, extraArgs) {\n    this.cachedQuery = query;\n    this.cachedSuggestions = suggestions;\n    this.cachedRenderExtraArgs = extraArgs;\n  },\n  shouldFetchFromCache: function shouldFetchFromCache(query) {\n    return this.cache && this.cachedQuery === query && this.cachedSuggestions && this.cachedSuggestions.length;\n  },\n  clearCachedSuggestions: function clearCachedSuggestions() {\n    delete this.cachedQuery;\n    delete this.cachedSuggestions;\n    delete this.cachedRenderExtraArgs;\n  },\n  cancel: function cancel() {\n    this.canceled = true;\n  },\n  clear: function clear() {\n    if (this.$el) {\n      this.cancel();\n      this.$el.empty();\n      this.trigger('rendered', '');\n    }\n  },\n  isEmpty: function isEmpty() {\n    return this._isEmpty;\n  },\n  destroy: function destroy() {\n    this.clearCachedSuggestions();\n    this.$el = null;\n  }\n}); // helper functions\n// ----------------\n\n\nfunction getDisplayFn(display) {\n  display = display || 'value';\n  return _.isFunction(display) ? display : displayFn;\n\n  function displayFn(obj) {\n    return obj[display];\n  }\n}\n\nfunction getTemplates(templates, displayFn) {\n  return {\n    empty: templates.empty && _.templatify(templates.empty),\n    header: templates.header && _.templatify(templates.header),\n    footer: templates.footer && _.templatify(templates.footer),\n    suggestion: templates.suggestion || suggestionTemplate\n  };\n\n  function suggestionTemplate(context) {\n    return '<p>' + displayFn(context) + '</p>';\n  }\n}\n\nfunction isValidName(str) {\n  // dashes, underscores, letters, and numbers\n  return /^[_a-zA-Z0-9-]+$/.test(str);\n}\n\nmodule.exports = Dataset;","map":{"version":3,"sources":["/home/kali/Documents/cybersecurity/client/node_modules/autocomplete.js/src/autocomplete/dataset.js"],"names":["datasetKey","valueKey","datumKey","_","require","DOM","html","css","EventEmitter","Dataset","o","templates","source","error","name","isValidName","query","_isEmpty","highlight","getUniqueId","displayFn","getDisplayFn","display","displayKey","debounce","cache","getTemplates","mixin","appendTo","cssClasses","defaultClasses","prefix","formattedPrefix","formatPrefix","noPrefix","clazz","className","dataset","$el","$menu","find","length","element","replace","clearCachedSuggestions","extractDatasetName","el","data","extractValue","extractDatum","datum","JSON","parse","prototype","_render","render","suggestions","that","hasSuggestions","renderArgs","slice","call","arguments","empty","getEmptyHtml","apply","prepend","header","getHeaderHtml","append","footer","getFooterHtml","getSuggestionsHtml","Array","isArray","TypeError","addClass","removeClass","trigger","args","isEmpty","concat","$suggestions","nodes","self","suggestionsHtml","map","getSuggestionNode","suggestion","suggestionHtml","attr","role","id","Math","floor","random","join","undefined","stringify","children","each","suggestionChild","getRoot","update","handleSuggestions","canceled","extraArgs","cacheSuggestions","shouldFetchFromCache","cachedSuggestions","cachedRenderExtraArgs","execSource","bind","later","debounceTimeout","clearTimeout","setTimeout","cachedQuery","cancel","clear","destroy","isFunction","obj","templatify","suggestionTemplate","context","str","test","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar datasetKey = 'aaDataset';\nvar valueKey = 'aaValue';\nvar datumKey = 'aaDatum';\n\nvar _ = require('../common/utils.js');\nvar DOM = require('../common/dom.js');\nvar html = require('./html.js');\nvar css = require('./css.js');\nvar EventEmitter = require('./event_emitter.js');\n\n// constructor\n// -----------\n\nfunction Dataset(o) {\n  o = o || {};\n  o.templates = o.templates || {};\n\n  if (!o.source) {\n    _.error('missing source');\n  }\n\n  if (o.name && !isValidName(o.name)) {\n    _.error('invalid dataset name: ' + o.name);\n  }\n\n  // tracks the last query the dataset was updated for\n  this.query = null;\n  this._isEmpty = true;\n\n  this.highlight = !!o.highlight;\n  this.name = typeof o.name === 'undefined' || o.name === null ? _.getUniqueId() : o.name;\n\n  this.source = o.source;\n  this.displayFn = getDisplayFn(o.display || o.displayKey);\n\n  this.debounce = o.debounce;\n\n  this.cache = o.cache !== false;\n\n  this.templates = getTemplates(o.templates, this.displayFn);\n\n  this.css = _.mixin({}, css, o.appendTo ? css.appendTo : {});\n  this.cssClasses = o.cssClasses = _.mixin({}, css.defaultClasses, o.cssClasses || {});\n  this.cssClasses.prefix =\n    o.cssClasses.formattedPrefix || _.formatPrefix(this.cssClasses.prefix, this.cssClasses.noPrefix);\n\n  var clazz = _.className(this.cssClasses.prefix, this.cssClasses.dataset);\n  this.$el = o.$menu && o.$menu.find(clazz + '-' + this.name).length > 0 ?\n    DOM.element(o.$menu.find(clazz + '-' + this.name)[0]) :\n    DOM.element(\n      html.dataset.replace('%CLASS%', this.name)\n        .replace('%PREFIX%', this.cssClasses.prefix)\n        .replace('%DATASET%', this.cssClasses.dataset)\n    );\n\n  this.$menu = o.$menu;\n  this.clearCachedSuggestions();\n}\n\n// static methods\n// --------------\n\nDataset.extractDatasetName = function extractDatasetName(el) {\n  return DOM.element(el).data(datasetKey);\n};\n\nDataset.extractValue = function extractValue(el) {\n  return DOM.element(el).data(valueKey);\n};\n\nDataset.extractDatum = function extractDatum(el) {\n  var datum = DOM.element(el).data(datumKey);\n  if (typeof datum === 'string') {\n    // Zepto has an automatic deserialization of the\n    // JSON encoded data attribute\n    datum = JSON.parse(datum);\n  }\n  return datum;\n};\n\n// instance methods\n// ----------------\n\n_.mixin(Dataset.prototype, EventEmitter, {\n\n  // ### private\n\n  _render: function render(query, suggestions) {\n    if (!this.$el) {\n      return;\n    }\n    var that = this;\n\n    var hasSuggestions;\n    var renderArgs = [].slice.call(arguments, 2);\n    this.$el.empty();\n\n    hasSuggestions = suggestions && suggestions.length;\n    this._isEmpty = !hasSuggestions;\n\n    if (!hasSuggestions && this.templates.empty) {\n      this.$el\n        .html(getEmptyHtml.apply(this, renderArgs))\n        .prepend(that.templates.header ? getHeaderHtml.apply(this, renderArgs) : null)\n        .append(that.templates.footer ? getFooterHtml.apply(this, renderArgs) : null);\n    } else if (hasSuggestions) {\n      this.$el\n        .html(getSuggestionsHtml.apply(this, renderArgs))\n        .prepend(that.templates.header ? getHeaderHtml.apply(this, renderArgs) : null)\n        .append(that.templates.footer ? getFooterHtml.apply(this, renderArgs) : null);\n    } else if (suggestions && !Array.isArray(suggestions)) {\n      throw new TypeError('suggestions must be an array');\n    }\n\n    if (this.$menu) {\n      this.$menu.addClass(\n        this.cssClasses.prefix + (hasSuggestions ? 'with' : 'without') + '-' + this.name\n      ).removeClass(\n        this.cssClasses.prefix + (hasSuggestions ? 'without' : 'with') + '-' + this.name\n      );\n    }\n\n    this.trigger('rendered', query);\n\n    function getEmptyHtml() {\n      var args = [].slice.call(arguments, 0);\n      args = [{query: query, isEmpty: true}].concat(args);\n      return that.templates.empty.apply(this, args);\n    }\n\n    function getSuggestionsHtml() {\n      var args = [].slice.call(arguments, 0);\n      var $suggestions;\n      var nodes;\n      var self = this;\n\n      var suggestionsHtml = html.suggestions.\n        replace('%PREFIX%', this.cssClasses.prefix).\n        replace('%SUGGESTIONS%', this.cssClasses.suggestions);\n      $suggestions = DOM\n        .element(suggestionsHtml)\n        .css(this.css.suggestions);\n\n      // jQuery#append doesn't support arrays as the first argument\n      // until version 1.8, see http://bugs.jquery.com/ticket/11231\n      nodes = _.map(suggestions, getSuggestionNode);\n      $suggestions.append.apply($suggestions, nodes);\n\n      return $suggestions;\n\n      function getSuggestionNode(suggestion) {\n        var $el;\n\n        var suggestionHtml = html.suggestion.\n          replace('%PREFIX%', self.cssClasses.prefix).\n          replace('%SUGGESTION%', self.cssClasses.suggestion);\n        $el = DOM.element(suggestionHtml)\n          .attr({\n            role: 'option',\n            id: ['option', Math.floor(Math.random() * 100000000)].join('-')\n          })\n          .append(that.templates.suggestion.apply(this, [suggestion].concat(args)));\n\n        $el.data(datasetKey, that.name);\n        $el.data(valueKey, that.displayFn(suggestion) || undefined); // this led to undefined return value\n        $el.data(datumKey, JSON.stringify(suggestion));\n        $el.children().each(function() { DOM.element(this).css(self.css.suggestionChild); });\n\n        return $el;\n      }\n    }\n\n    function getHeaderHtml() {\n      var args = [].slice.call(arguments, 0);\n      args = [{query: query, isEmpty: !hasSuggestions}].concat(args);\n      return that.templates.header.apply(this, args);\n    }\n\n    function getFooterHtml() {\n      var args = [].slice.call(arguments, 0);\n      args = [{query: query, isEmpty: !hasSuggestions}].concat(args);\n      return that.templates.footer.apply(this, args);\n    }\n  },\n\n  // ### public\n\n  getRoot: function getRoot() {\n    return this.$el;\n  },\n\n  update: function update(query) {\n    function handleSuggestions(suggestions) {\n      // if the update has been canceled or if the query has changed\n      // do not render the suggestions as they've become outdated\n      if (!this.canceled && query === this.query) {\n        // concat all the other arguments that could have been passed\n        // to the render function, and forward them to _render\n        var extraArgs = [].slice.call(arguments, 1);\n        this.cacheSuggestions(query, suggestions, extraArgs);\n        this._render.apply(this, [query, suggestions].concat(extraArgs));\n      }\n    }\n\n    this.query = query;\n    this.canceled = false;\n\n    if (this.shouldFetchFromCache(query)) {\n      handleSuggestions.apply(this, [this.cachedSuggestions].concat(this.cachedRenderExtraArgs));\n    } else {\n      var that = this;\n      var execSource = function() {\n        // When the call is debounced the condition avoid to do a useless\n        // request with the last character when the input has been cleared\n        if (!that.canceled) {\n          that.source(query, handleSuggestions.bind(that));\n        }\n      };\n\n      if (this.debounce) {\n        var later = function() {\n          that.debounceTimeout = null;\n          execSource();\n        };\n        clearTimeout(this.debounceTimeout);\n        this.debounceTimeout = setTimeout(later, this.debounce);\n      } else {\n        execSource();\n      }\n    }\n  },\n\n  cacheSuggestions: function cacheSuggestions(query, suggestions, extraArgs) {\n    this.cachedQuery = query;\n    this.cachedSuggestions = suggestions;\n    this.cachedRenderExtraArgs = extraArgs;\n  },\n\n  shouldFetchFromCache: function shouldFetchFromCache(query) {\n    return this.cache &&\n      this.cachedQuery === query &&\n      this.cachedSuggestions &&\n      this.cachedSuggestions.length;\n  },\n\n  clearCachedSuggestions: function clearCachedSuggestions() {\n    delete this.cachedQuery;\n    delete this.cachedSuggestions;\n    delete this.cachedRenderExtraArgs;\n  },\n\n  cancel: function cancel() {\n    this.canceled = true;\n  },\n\n  clear: function clear() {\n    if (this.$el) {\n      this.cancel();\n      this.$el.empty();\n      this.trigger('rendered', '');\n    }\n  },\n\n  isEmpty: function isEmpty() {\n    return this._isEmpty;\n  },\n\n  destroy: function destroy() {\n    this.clearCachedSuggestions();\n    this.$el = null;\n  }\n});\n\n// helper functions\n// ----------------\n\nfunction getDisplayFn(display) {\n  display = display || 'value';\n\n  return _.isFunction(display) ? display : displayFn;\n\n  function displayFn(obj) {\n    return obj[display];\n  }\n}\n\nfunction getTemplates(templates, displayFn) {\n  return {\n    empty: templates.empty && _.templatify(templates.empty),\n    header: templates.header && _.templatify(templates.header),\n    footer: templates.footer && _.templatify(templates.footer),\n    suggestion: templates.suggestion || suggestionTemplate\n  };\n\n  function suggestionTemplate(context) {\n    return '<p>' + displayFn(context) + '</p>';\n  }\n}\n\nfunction isValidName(str) {\n  // dashes, underscores, letters, and numbers\n  return (/^[_a-zA-Z0-9-]+$/).test(str);\n}\n\nmodule.exports = Dataset;\n"]},"metadata":{},"sourceType":"script"}